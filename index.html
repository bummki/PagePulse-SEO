<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PagePulse SEO â€” On-Page Inspector (Single HTML)</title>
  <meta name="description" content="ì œëª©Â·ë©”íƒ€Â·URLÂ·ë¶€ì œëª©Â·ì´ë¯¸ì§€ ALTÂ·ë§í¬Â·ë°€ë„Â·TOCÂ·ìŠ¤í‚¤ë§ˆÂ·OG/TwitterÂ·E-E-A-Tê¹Œì§€ í•œ ë²ˆì— ì ê²€í•˜ëŠ” ì˜¤í”„ë¼ì¸ ë‹¨ì¼ HTML SEO ì²´ì»¤.">
  <style>
    :root{--bg:#0b0e13;--card:#121826;--muted:#98a2b3;--text:#e6edf3;--ok:#16a34a;--warn:#f59e0b;--fail:#ef4444;--accent:#22d3ee;--accent2:#00ffa6;--border:#202a3b;--glass:rgba(18,24,38,.55);--glassBorder:rgba(255,255,255,.06)}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:var(--text);background:linear-gradient(180deg,#0a0f1c,#0b1220) fixed}
    header{position:sticky;top:0;z-index:5;background:rgba(10,15,28,.8);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-weight:800;letter-spacing:.2px;margin:0;font-size:1.35rem}
    .sub{color:var(--muted);font-size:.9rem}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{background:linear-gradient(180deg, rgba(18,24,38,.66), rgba(18,24,38,.38));border:1px solid var(--glassBorder);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);backdrop-filter:blur(12px) saturate(140%);transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease}
    .card h2{margin:.1rem 0 8px;font-size:1rem}
    label{display:block;font-size:.85rem;color:var(--muted);margin:6px 0}
    input,textarea,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0b1322;color:var(--text);outline:none}
    textarea{min-height:220px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .btn{cursor:pointer;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#0c172a;color:#fff;transition:transform .15s ease, background .15s ease, box-shadow .15s ease}
    .btn:hover{background:#0f1d36;transform:translateY(-1px)}
    .btn.primary{background:linear-gradient(135deg,#00e5ff,#00ffa6);color:#05202c;border:none;box-shadow:0 6px 20px rgba(0,229,255,.25)}
    .tag{padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:.75rem;color:var(--muted)}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .kpi > div{padding:12px 12px;border-radius:14px;border:1px solid var(--border);background:#0d1526}
    .kpi .value{font-size:1.2rem;font-weight:700}
    .status{display:flex;align-items:center;gap:8px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:var(--ok)} .dot.warn{background:var(--warn)} .dot.fail{background:var(--fail)}
    .score{font-size:2.2rem;font-weight:800}
    .progress{height:10px;border-radius:999px;background:#0c1526;border:1px solid var(--border);overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#00ffa6,#00e5ff)}
    .checklist{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .item{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:12px;background:#0d1729;border:1px solid var(--border)}
    .item .msg{font-size:.9rem}
    .item .hint{color:var(--muted);font-size:.8rem;margin-top:4px}
    .footer{color:var(--muted);font-size:.8rem;margin-top:16px}
    details{background:#0d1526;border:1px solid var(--border);border-radius:12px;padding:10px}
    summary{cursor:pointer}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .lang{margin-left:auto}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Monospace}
    .small{font-size:.8rem;color:var(--muted)}
    .card:hover{transform:translateY(-2px);box-shadow:0 16px 40px rgba(0,0,0,.35);border-color:rgba(255,255,255,.12)}
    .item.ok{border-left:3px solid var(--ok);box-shadow:0 0 0 1px rgba(22,163,74,.2) inset}
    .item.warn{border-left:3px solid var(--warn);box-shadow:0 0 0 1px rgba(245,158,11,.2) inset}
    .item.fail{border-left:3px solid var(--fail);box-shadow:0 0 0 1px rgba(239,68,68,.2) inset}
    .toast{position:fixed;right:16px;bottom:16px;padding:12px 14px;border-radius:12px;border:1px solid var(--glassBorder);background:rgba(13,21,38,.9);backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(0,0,0,.3);transform:translateY(10px);opacity:0;transition:all .2s ease;z-index:50}
    .toast.show{transform:translateY(0);opacity:1}
    .toast.ok{border-left:3px solid var(--ok)}
    .toast.warn{border-left:3px solid var(--warn)}
    .toast.fail{border-left:3px solid var(--fail)}
    .tag.grade-a-plus,.tag.grade-a{background:linear-gradient(135deg,var(--accent2),var(--accent));color:#05202c;border-color:transparent}
    .tag.grade-b{background:rgba(34,211,238,.12);border-color:rgba(34,211,238,.35)}
    .tag.grade-c{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.35)}
    .tag.grade-d{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.35)}
    .tag.grade-f{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.5)}
    .btn:active{transform:translateY(0) scale(.98)}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .checklist{grid-template-columns:1fr}
      .kpi{grid-template-columns:repeat(2,1fr)}
      textarea{min-height:180px}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap row" style="align-items:center;">
    <h1>PagePulse SEO <span class="sub">â€” On-Page Inspector (Single HTML)</span></h1>
    <div class="lang row" style="align-items:flex-end; gap:8px">
      <label for="uiLang" class="small" data-i="language_label">UI ì–¸ì–´ / Language</label>
      <select id="uiLang">
        <option value="ko">í•œêµ­ì–´</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="es">EspaÃ±ol</option>
      </select>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card" style="grid-column: span 7;">
      <h2 data-i="content_input">Content Input</h2>
      <div>
        <label data-i="focus_keyword">í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ (Focus Keyword)</label>
        <input id="focus" placeholder="ì˜ˆ: 2025ë…„ ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­" />
      </div>
      <div class="grid-2">
        <div>
          <label data-i="site_domain">ì‚¬ì´íŠ¸ ë„ë©”ì¸ (ë‚´ë¶€ë§í¬ íŒë³„)</label>
          <input id="domain" placeholder="ì˜ˆ: onnuriinfo.com" />
        </div>
      </div>
      <label data-i="seo_title">SEO ì œëª©</label>
      <input id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
      <div class="row" style="margin-top:6px">
        <button class="btn" id="suggestTitle">ğŸ”® <span data-i="suggest_title">ì œëª© ê°œì„ </span></button>
        <span class="tag" id="titleLen">0 chars</span>
      </div>
      <label data-i="meta_desc">ë©”íƒ€ ì„¤ëª…</label>
      <textarea id="desc" placeholder="ê²€ìƒ‰ê²°ê³¼ì— ë³´ì¼ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ê¶Œì¥ 100~160ì)"></textarea>
      <div class="row" style="margin-top:6px">
        <span class="tag" id="descLen">0 chars</span>
      </div>
      <div class="grid-2">
        <div>
          <label data-i="url_slug">URL ìŠ¬ëŸ¬ê·¸</label>
          <input id="slug" placeholder="ì˜ˆ: weekend-application-guide-2025" />
        </div>
        <div>
          <label data-i="prev_keywords">ì´ì „ì— ì‚¬ìš©í•œ í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input id="usedKeywords" placeholder="ì˜ˆ: ë¯¼ìƒì†Œë¹„ì¿ í°, ìµœì €ì„ê¸ˆ 2025" />
        </div>
      </div>
      <div class="row" style="margin:8px 0 4px">
        <label class="pill"><input type="checkbox" id="pillar" /> <span data-i="pillar">ì´ ê²Œì‹œë¬¼ì€ Pillar Contentì…ë‹ˆë‹¤</span></label>
        <button class="btn" id="makeSlug">ğŸ”§ <span data-i="make_slug">ì œëª©ìœ¼ë¡œ ìŠ¬ëŸ¬ê·¸ ìë™ ìƒì„±</span></button>
        <button class="btn" id="addToc">ğŸ§­ <span data-i="insert_toc">[toc] ì‚½ì…</span></button>
      </div>
      <label data-i="main_content">ë³¸ë¬¸ (Markdown ë˜ëŠ” HTML ê°€ëŠ¥)</label>
      <textarea id="content" placeholder="ì—¬ê¸°ì— ì½˜í…ì¸ ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì´ë¯¸ì§€, ë§í¬, ì œëª©(H2/H3), [toc] ë“±ì„ í¬í•¨í•˜ë©´ ìë™ ê°ì§€í•©ë‹ˆë‹¤."></textarea>
      <div class="row" style="margin-top:8px">
        <button class="btn primary" id="analyze">âœ… <span data-i="run_check">ì²´í¬ ì‹¤í–‰ / ì‹¤ì‹œê°„ ë¶„ì„</span></button>
        <button class="btn" id="copyReport">ğŸ“‹ <span data-i="copy_report">ë¦¬í¬íŠ¸ ë³µì‚¬</span></button>
        <button class="btn" id="downloadMd">â¬‡ï¸ <span data-i="download_md">Markdown ì €ì¥</span></button>
        <span class="tag">PagePulse SEO v1.1 Â· ë‹¨ì¼ HTML Â· ì˜¤í”„ë¼ì¸</span>
      </div>
    </section>

    <section class="card" style="grid-column: span 5;">
      <h2 data-i="score">Score</h2>
      <div class="row" style="align-items:center; gap:16px">
        <div class="score" id="score">0</div>
        <div style="flex:1">
          <div class="progress"><div class="bar" id="bar" style="width:0%"></div></div>
          <div class="small" id="gradeNote" style="margin-top:6px">â€”</div>
        </div>
        <div class="tag" id="grade">â€“</div>
      </div>
      <div class="kpi" style="margin-top:12px">
        <div>
          <div class="small" data-i="kpi_words">ë‹¨ì–´ ìˆ˜</div>
          <div class="value" id="kpiWords">0</div>
          <div class="small" id="kpiWordHint">600â€“2500 ê¶Œì¥</div>
        </div>
        <div>
          <div class="small" data-i="kpi_density">í‚¤ì›Œë“œ ë°€ë„</div>
          <div class="value" id="kpiDensity">0%</div>
          <div class="small">ê¶Œì¥ 0.8%â€“1.2%</div>
        </div>
        <div>
          <div class="small" data-i="kpi_images">ì´ë¯¸ì§€ ìˆ˜</div>
          <div class="value" id="kpiImages">0</div>
          <div class="small" id="kpiAlt">ALTì— í‚¤ì›Œë“œ 0ê°œ</div>
        </div>
        <div>
          <div class="small" data-i="kpi_links">ë§í¬(ë‚´ë¶€/ì™¸ë¶€)</div>
          <div class="value" id="kpiLinks">0 / 0</div>
          <div class="small" id="kpiFollow">DoFollow ì™¸ë¶€ 0ê°œ</div>
        </div>
      </div>
      <div style="margin-top:14px">
        <details>
          <summary>ğŸ” <b data-i="details">ì„¸ë¶€ ì§€í‘œ / Details</b></summary>
          <div class="small mono" id="rawStats" style="margin-top:8px;white-space:pre-wrap"></div>
        </details>
      </div>
    </section>

    <section class="card" style="grid-column: span 12;">
      <h2 data-i="checklist">Checklist</h2>
      <div class="checklist" id="checklist"></div>
      <div class="footer">Tip: ë³¸ ë„êµ¬ëŠ” ì½˜í…ì¸ ë¥¼ ë¡œì»¬ì—ì„œë§Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²° ë° ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤.</div>
    </section>

    <section class="card" style="grid-column: span 12;">
      <h2 data-i="step_by_step">Step-by-Step (ê°€ì´ë“œ)</h2>
      <ol>
        <li>í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ì •í•˜ê³  <b>ì œëª©/ë©”íƒ€/URL/ë³¸ë¬¸</b>ì— ì ì ˆíˆ ë°°ì¹˜í•©ë‹ˆë‹¤.</li>
        <li>ë³¸ë¬¸ì„ ë¶™ì—¬ë„£ê³  <b>H2/H3 ë¶€ì œëª©</b>ì— í‚¤ì›Œë“œë¥¼ 1â€“2íšŒ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
        <li>ì´ë¯¸ì§€ë¥¼ ë„£ê³  <b>ALT</b>ì— ìì—°ìŠ¤ëŸ½ê²Œ í‚¤ì›Œë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.</li>
        <li><b>[toc]</b> ë˜ëŠ” ì œëª©ì´ ë§ë‹¤ë©´ ìë™ ëª©ì°¨ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</li>
        <li>ë‚´ë¶€/ì™¸ë¶€ ë§í¬ë¥¼ ìµœì†Œ 1ê°œ ì´ìƒ í¬í•¨í•˜ê³ , ì™¸ë¶€ ë§í¬ëŠ” <b>dofollow</b>ë¥¼ 1ê°œ ì´ìƒ ìœ ì§€í•©ë‹ˆë‹¤.</li>
        <li>ë‹¨ì–´ ìˆ˜ 600â€“2500, í‚¤ì›Œë“œ ë°€ë„ 0.8â€“1.2% ë²”ìœ„ë¥¼ ë§ì¶¥ë‹ˆë‹¤.</li>
        <li>â€˜ë¦¬í¬íŠ¸ ë³µì‚¬â€™ ë˜ëŠ” â€˜Markdown ì €ì¥â€™ìœ¼ë¡œ ê¸°ë¡/ê³µìœ í•˜ì„¸ìš”.</li>
      </ol>
    </section>
  </div>
</main>

<script>
// ====== i18n (ê°„ë‹¨ ì‚¬ì „) ======
const I18N = {
  ko:{content_input:"ì½˜í…ì¸  ì…ë ¥", focus_keyword:"í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ (Focus Keyword)", site_domain:"ì‚¬ì´íŠ¸ ë„ë©”ì¸ (ë‚´ë¶€ë§í¬ íŒë³„)", seo_title:"SEO ì œëª©", suggest_title:"ì œëª© ê°œì„ ", meta_desc:"ë©”íƒ€ ì„¤ëª…", url_slug:"URL ìŠ¬ëŸ¬ê·¸", prev_keywords:"ì´ì „ì— ì‚¬ìš©í•œ í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)", pillar:"ì´ ê²Œì‹œë¬¼ì€ Pillar Contentì…ë‹ˆë‹¤", make_slug:"ì œëª©ìœ¼ë¡œ ìŠ¬ëŸ¬ê·¸ ìë™ ìƒì„±", insert_toc:"[toc] ì‚½ì…", main_content:"ë³¸ë¬¸ (Markdown ë˜ëŠ” HTML ê°€ëŠ¥)", run_check:"ì²´í¬ ì‹¤í–‰ / ì‹¤ì‹œê°„ ë¶„ì„", copy_report:"ë¦¬í¬íŠ¸ ë³µì‚¬", download_md:"Markdown ì €ì¥", kpi_words:"ë‹¨ì–´ ìˆ˜", kpi_density:"í‚¤ì›Œë“œ ë°€ë„", kpi_images:"ì´ë¯¸ì§€ ìˆ˜", kpi_links:"ë§í¬(ë‚´ë¶€/ì™¸ë¶€)",
      score:"ì ìˆ˜", checklist:"ì²´í¬ë¦¬ìŠ¤íŠ¸", step_by_step:"ë‹¨ê³„ë³„ ê°€ì´ë“œ", details:"ì„¸ë¶€ ì§€í‘œ / Details", language_label:"UI ì–¸ì–´ / Language", schema_panel:"ë¦¬ì¹˜ ê²°ê³¼ & ìŠ¤í‚¤ë§ˆ", og_panel:"OG/Twitter ë©”íƒ€ ìƒì„±ê¸°", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T ì²´í¬ë¦¬ìŠ¤íŠ¸", copy_meta:"ë©”íƒ€ íƒœê·¸ ë³µì‚¬",
      // placeholders
      ph_focus:"ì˜ˆ: 2025ë…„ ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­",
      ph_domain:"ì˜ˆ: onnuriinfo.com",
      ph_title:"ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”",
      ph_desc:"ê²€ìƒ‰ê²°ê³¼ì— ë³´ì¼ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ê¶Œì¥ 100~160ì)",
      ph_slug:"ì˜ˆ: weekend-application-guide-2025",
      ph_used:"ì˜ˆ: ë¯¼ìƒì†Œë¹„ì¿ í°, ìµœì €ì„ê¸ˆ 2025",
      ph_content:"ì—¬ê¸°ì— ì½˜í…ì¸ ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. ì´ë¯¸ì§€, ë§í¬, ì œëª©(H2/H3), [toc] ë“±ì„ í¬í•¨í•˜ë©´ ìë™ ê°ì§€í•©ë‹ˆë‹¤."},
  en:{content_input:"Content Input", focus_keyword:"Focus Keyword", site_domain:"Site Domain (internal link check)", seo_title:"SEO Title", suggest_title:"Improve Title", meta_desc:"Meta Description", url_slug:"URL Slug", prev_keywords:"Previously used keywords (comma-separated)", pillar:"This post is Pillar Content", make_slug:"Slugify from title", insert_toc:"Insert [toc]", main_content:"Body (Markdown or HTML)", run_check:"Run Check / Live Analyze", copy_report:"Copy Report", download_md:"Save Markdown", kpi_words:"Word Count", kpi_density:"Keyword Density", kpi_images:"Images", kpi_links:"Links (internal/external)",
      score:"Score", checklist:"Checklist", step_by_step:"Step-by-Step (Guide)", details:"Details", language_label:"UI Language", schema_panel:"Rich Results & Schema", og_panel:"OG/Twitter Meta Generator", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T Checklist", copy_meta:"Copy meta tags",
      ph_focus:"e.g., weekend voucher application 2025",
      ph_domain:"e.g., example.com",
      ph_title:"Enter a title",
      ph_desc:"Write a snippet for search (100â€“160 chars recommended)",
      ph_slug:"e.g., weekend-application-guide-2025",
      ph_used:"e.g., living coupon, minimum wage 2025",
      ph_content:"Paste content here. Include images, links, H2/H3, and [toc]."},
  ja:{content_input:"ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥åŠ›", focus_keyword:"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", site_domain:"ã‚µã‚¤ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ (å†…éƒ¨ãƒªãƒ³ã‚¯åˆ¤å®š)", seo_title:"SEOã‚¿ã‚¤ãƒˆãƒ«", suggest_title:"ã‚¿ã‚¤ãƒˆãƒ«æ”¹å–„", meta_desc:"ãƒ¡ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³", url_slug:"URLã‚¹ãƒ©ãƒƒã‚°", prev_keywords:"éå»ã«ä½¿ç”¨ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", pillar:"ã“ã®æŠ•ç¨¿ã¯ãƒ”ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", make_slug:"ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆ", insert_toc:"[toc] æŒ¿å…¥", main_content:"æœ¬æ–‡ (Markdown / HTML)", run_check:"ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ / ãƒ©ã‚¤ãƒ–åˆ†æ", copy_report:"ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼", download_md:"Markdown ä¿å­˜", kpi_words:"å˜èªæ•°", kpi_density:"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯†åº¦", kpi_images:"ç”»åƒæ•°", kpi_links:"ãƒªãƒ³ã‚¯(å†…éƒ¨/å¤–éƒ¨)",
      score:"ã‚¹ã‚³ã‚¢", checklist:"ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ", step_by_step:"ã‚¹ãƒ†ãƒƒãƒ—ãƒ»ãƒã‚¤ãƒ»ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆã‚¬ã‚¤ãƒ‰ï¼‰", details:"è©³ç´°æŒ‡æ¨™ / Details", language_label:"UI è¨€èª / Language", schema_panel:"ãƒªãƒƒãƒãƒªã‚¶ãƒ«ãƒˆ & ã‚¹ã‚­ãƒ¼ãƒ", og_panel:"OG/Twitter ãƒ¡ã‚¿ç”Ÿæˆ", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ", copy_meta:"ãƒ¡ã‚¿ã‚¿ã‚°ã‚’ã‚³ãƒ”ãƒ¼",
      ph_focus:"ä¾‹ï¼šé€±æœ«ç”³è«‹ ãƒã‚¦ãƒãƒ£ãƒ¼ 2025",
      ph_domain:"ä¾‹ï¼šexample.com",
      ph_title:"ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
      ph_desc:"æ¤œç´¢çµæœã«è¡¨ç¤ºã•ã‚Œã‚‹èª¬æ˜ï¼ˆæ¨å¥¨100ï½160æ–‡å­—ï¼‰",
      ph_slug:"ä¾‹ï¼šweekend-application-guide-2025",
      ph_used:"ä¾‹ï¼šãƒã‚¦ãƒãƒ£ãƒ¼, æœ€ä½è³ƒé‡‘ 2025",
      ph_content:"ã“ã“ã«æœ¬æ–‡ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ç”»åƒãƒ»ãƒªãƒ³ã‚¯ãƒ»H2/H3ãƒ»[toc] ãªã©ã€‚"},
  zh:{content_input:"å†…å®¹è¾“å…¥", focus_keyword:"ç„¦ç‚¹å…³é”®è¯", site_domain:"ç«™ç‚¹åŸŸå(å†…éƒ¨é“¾æ¥åˆ¤æ–­)", seo_title:"SEO æ ‡é¢˜", suggest_title:"ä¼˜åŒ–æ ‡é¢˜", meta_desc:"å…ƒæè¿°", url_slug:"URL åˆ«å", prev_keywords:"ä»¥å¾€ç”¨è¿‡çš„å…³é”®è¯", pillar:"æ­¤æ–‡ä¸ºæ”¯æŸ±å†…å®¹", make_slug:"æ ¹æ®æ ‡é¢˜ç”Ÿæˆåˆ«å", insert_toc:"æ’å…¥ [toc]", main_content:"æ­£æ–‡ (Markdown æˆ– HTML)", run_check:"æ‰§è¡Œæ£€æŸ¥ / å®æ—¶åˆ†æ", copy_report:"å¤åˆ¶æŠ¥å‘Š", download_md:"ä¿å­˜ Markdown", kpi_words:"å­—æ•°", kpi_density:"å…³é”®è¯å¯†åº¦", kpi_images:"å›¾ç‰‡æ•°", kpi_links:"é“¾æ¥(å†…éƒ¨/å¤–éƒ¨)",
      score:"åˆ†æ•°", checklist:"æ£€æŸ¥æ¸…å•", step_by_step:"æ­¥éª¤æŒ‡å—", details:"è¯¦ç»†æŒ‡æ ‡ / è¯¦æƒ…", language_label:"ç•Œé¢è¯­è¨€ / Language", schema_panel:"å¯Œç»“æœä¸ Schema", og_panel:"OG/Twitter å…ƒæ ‡ç­¾ç”Ÿæˆå™¨", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T æ£€æŸ¥æ¸…å•", copy_meta:"å¤åˆ¶å…ƒæ ‡ç­¾",
      ph_focus:"ä¾‹å¦‚ï¼šå‘¨æœ«ç”³è¯· æ¶ˆè´¹åˆ¸ 2025",
      ph_domain:"ä¾‹å¦‚ï¼šexample.com",
      ph_title:"è¯·è¾“å…¥æ ‡é¢˜",
      ph_desc:"å±•ç¤ºåœ¨æœç´¢ç»“æœä¸­çš„æè¿°ï¼ˆå»ºè®®100â€“160å­—ï¼‰",
      ph_slug:"ä¾‹å¦‚ï¼šweekend-application-guide-2025",
      ph_used:"ä¾‹å¦‚ï¼šæ¶ˆè´¹åˆ¸, 2025æœ€ä½å·¥èµ„",
      ph_content:"åœ¨æ­¤ç²˜è´´å†…å®¹ã€‚å¯åŒ…å«å›¾ç‰‡ã€é“¾æ¥ã€H2/H3ï¼Œä»¥åŠ [toc]ã€‚"},
  es:{content_input:"Entrada de contenido", focus_keyword:"Palabra clave principal", site_domain:"Dominio del sitio (enlaces internos)", seo_title:"TÃ­tulo SEO", suggest_title:"Mejorar tÃ­tulo", meta_desc:"Meta descripciÃ³n", url_slug:"Slug de URL", prev_keywords:"Palabras clave usadas antes", pillar:"Este artÃ­culo es Pilar", make_slug:"Slug desde tÃ­tulo", insert_toc:"Insertar [toc]", main_content:"Cuerpo (Markdown/HTML)", run_check:"Ejecutar revisiÃ³n / AnÃ¡lisis en vivo", copy_report:"Copiar informe", download_md:"Guardar Markdown", kpi_words:"Cantidad de palabras", kpi_density:"Densidad de palabra clave", kpi_images:"ImÃ¡genes", kpi_links:"Enlaces (internos/externos)",
      score:"PuntuaciÃ³n", checklist:"Lista de verificaciÃ³n", step_by_step:"Paso a paso (guÃ­a)", details:"Indicadores / Detalles", language_label:"Idioma de la UI", schema_panel:"Resultados enriquecidos y Schema", og_panel:"Generador de metadatos OG/Twitter", eeat_panel:"Lista Eâ€‘Eâ€‘Aâ€‘T", copy_meta:"Copiar etiquetas meta",
      ph_focus:"p. ej., solicitud de cupÃ³n de fin de semana 2025",
      ph_domain:"p. ej., ejemplo.com",
      ph_title:"Introduce un tÃ­tulo",
      ph_desc:"DescripciÃ³n para el snippet (recomendado 100â€“160 caracteres)",
      ph_slug:"p. ej., weekend-application-guide-2025",
      ph_used:"p. ej., cupÃ³n, salario mÃ­nimo 2025",
      ph_content:"Pega tu contenido aquÃ­. Incluye imÃ¡genes, enlaces, H2/H3 y [toc]."}
};
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));
function setLang(lang){
  const dict = I18N[lang]||I18N.ko;
  window.PP_LANG = lang;
  // í…ìŠ¤íŠ¸ ë…¸ë“œ ë²ˆì—­
  $$('[data-i]').forEach(el=>{
    const k=el.getAttribute('data-i');
    if(dict[k]) el.textContent=dict[k]
  });
  // placeholder ë²ˆì—­ (ì…ë ¥/í…ìŠ¤íŠ¸ì˜ì—­)
  const pmap = { focus:'ph_focus', domain:'ph_domain', title:'ph_title', desc:'ph_desc', slug:'ph_slug', usedKeywords:'ph_used', content:'ph_content' };
  Object.entries(pmap).forEach(([id,key])=>{
    const el=document.getElementById(id);
    if(el && dict[key]) el.setAttribute('placeholder', dict[key]);
  });
  if(window._applyExtLang) window._applyExtLang();
}
$('#uiLang').addEventListener('change',e=>setLang(e.target.value));
setLang('ko');

// ====== Helpers ======
function showToast(message,type='ok'){
  const el=document.createElement('div');
  el.className='toast '+type;
  el.setAttribute('role','status');
  el.setAttribute('aria-live','polite');
  el.textContent=message;
  document.body.appendChild(el);
  setTimeout(()=>{el.classList.add('show')},10);
  setTimeout(()=>{el.classList.remove('show'); el.addEventListener('transitionend',()=>el.remove(),{once:true})},2500);
}
const stripHtml = (html)=>html.replace(/<script[\s\S]*?<\/script>/gi,'').replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<[^>]+>/g,' ');
const getWords = (txt)=> (txt||'').trim().split(/\s+|(?<![ê°€-í£A-Za-z0-9])(?=[ê°€-í£A-Za-z0-9])/u).filter(Boolean);
const wordCount = (txt)=> getWords(stripHtml(txt)).length;
const occ = (text, kw)=>{ if(!kw) return 0; const t=(text||'').toLowerCase(); const k=kw.toLowerCase().trim(); return (t.match(new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'))||[]).length }
const slugify = s=> (s||'').toString().trim().toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-ê°€-í£]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');
const inFirstTenPercent = (text, kw)=>{
  const words = getWords(stripHtml(text)); if(!kw||words.length===0) return false; const idx = words.join(' ').toLowerCase().indexOf(kw.toLowerCase()); if(idx<0) return false; const tenth = Math.floor(stripHtml(text).length*0.1); return idx <= tenth;
}
function parseImages(content){
  const html = content; const imgs=[];
  // HTML <img alt="...">
  for(const m of html.matchAll(/<img[^>]*alt\s*=\s*"([^"]*)"[^>]*>/gi)){ imgs.push({alt:m[1]}) }
  // Markdown ![alt](src)
  for(const m of html.matchAll(/!\[([^\]]*)\]\(([^\)]+)\)/g)){ imgs.push({alt:m[1]}) }
  return imgs;
}
function parseLinks(content){
  const links=[]; const d=$('#domain').value.trim();
  // HTML <a href>
  for(const m of content.matchAll(/<a[^>]*href\s*=\s*"([^"]+)"[^>]*?(rel\s*=\s*"([^"]*)")?[^>]*>/gi)){
    const href = m[1]; const rel = (m[3]||'').toLowerCase(); const isExternal = /^https?:\/\//i.test(href) && (!d || !href.includes(d));
    const isInternal = d? href.includes(d) || /^\//.test(href) : !/^https?:\/\//i.test(href) || /^\//.test(href);
    links.push({href, isExternal, isInternal, dofollow: isExternal && !/nofollow/.test(rel)})
  }
  // Markdown [text](url)
  for(const m of content.matchAll(/\[[^\]]*\]\(([^\)]+)\)/g)){
    const href=m[1]; const isExternal = /^https?:\/\//i.test(href) && (!d || !href.includes(d));
    const isInternal = d? href.includes(d) || /^\//.test(href) : !/^https?:\/\//i.test(href) || /^\//.test(href);
    links.push({href, isExternal, isInternal, dofollow:isExternal}) // markdownì€ rel ì •ë³´ ë¶€ì¬ ê°€ì •
  }
  return links;
}
function parseHeadings(content){
  const hs=[];
  for(const m of content.matchAll(/<h([23])[^>]*>([\s\S]*?)<\/h\1>/gi)){ hs.push({level:+m[1], text: m[2].replace(/<[^>]+>/g,'').trim()}) }
  for(const m of content.matchAll(/^\s*#{2,3}\s+(.+)$/gmi)){ const hashes=(m[0].match(/#/g)||[]).length; hs.push({level:hashes, text:m[1].trim()}) }
  return hs;
}
function hasTOC(content){ return /\[toc\]/i.test(content) || /<nav[^>]*class\s*=\s*"[^"]*toc[^"]*"/i.test(content) }
function hasMedia(content){ return /<img|!\[|<video|<iframe/i.test(content) }

// ====== Analyzer ======
function analyze(){
  const focus=$('#focus').value.trim();
  const title=$('#title').value||'';
  const desc=$('#desc').value||'';
  const slug=$('#slug').value.trim();
  const used = ($('#usedKeywords').value||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
  const pillar = $('#pillar').checked;
  const content = $('#content').value||'';

  const text = stripHtml(content);
  const wc = wordCount(content);
  const kOcc = occ(text, focus);
  const density = wc? (kOcc / wc * 100):0;
  const imgs = parseImages(content);
  const imgKw = imgs.filter(i=> (i.alt||'').toLowerCase().includes(focus.toLowerCase())).length;
  const links = parseLinks(content);
  const intLinks = links.filter(l=>l.isInternal).length;
  const extLinks = links.filter(l=>l.isExternal).length;
  const doFollowExt = links.filter(l=>l.isExternal && l.dofollow).length;
  const hs = parseHeadings(content);
  const hKw = hs.filter(h=> h.text.toLowerCase().includes(focus.toLowerCase())).length;
  const first10 = inFirstTenPercent(content, focus);
  const urlHasKw = slug.toLowerCase().includes(focus.toLowerCase());
  const titleHasKw = title.toLowerCase().includes(focus.toLowerCase());
  const titleStartsKw = title.trim().toLowerCase().startsWith(focus.toLowerCase());
  const titleHasNum = /\d/.test(title);
  const titleLen = title.length;
  const descHasKw = desc.toLowerCase().includes(focus.toLowerCase());
  const descLen = desc.length;
  const toc = hasTOC(content);
  const media = hasMedia(content);
  const usedBefore = used.includes(focus.toLowerCase());
  const altHasKw = imgKw>0;

  // Scoring (100ì  ë§Œì )
  let score=0; const checks=[]; const add=(ok,label,hint='')=>{checks.push({ok,label,hint})}
  // ê°€ì¤‘ì¹˜ ì„¤ê³„
  // ì œëª©/ì„¤ëª…/URL/ì´ˆë°˜ë…¸ì¶œ/ë¶€ì œëª©/ALT/ë§í¬/ë‹¨ì–´ìˆ˜/ë°€ë„/TOC/ë¯¸ë””ì–´
  if(titleHasKw){score+=10; add(true,'SEO ì œëª©ì— í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ í¬í•¨','í‚¤ì›Œë“œëŠ” ì œëª© ì•ìª½ì— ë°°ì¹˜í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.')} else add(false,'SEO ì œëª©ì— í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ ì—†ìŒ','ì œëª©ì— ì •í™•í•œ í‚¤ì›Œë“œë¥¼ 1íšŒ í¬í•¨í•˜ì„¸ìš”.');
  if(titleStartsKw){score+=5; add(true,'SEO ì œëª©ì˜ ì•ìª½ì— í‚¤ì›Œë“œ','ê°€ëŠ¥í•˜ë‹¤ë©´ í‚¤ì›Œë“œë¡œ ì‹œì‘í•˜ì„¸ìš”.')} else add(null,'SEO ì œëª©ì˜ ì•ìª½ì— í‚¤ì›Œë“œ ì•„ë‹˜','ê°€ëŠ¥í•˜ë©´ ì œëª©ì„ í‚¤ì›Œë“œë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.');
  if(titleHasNum){score+=3; add(true,'SEO ì œëª©ì— ìˆ«ì í¬í•¨','ë¦¬ìŠ¤íŠ¸/ì—°ë„/ìˆ˜ì¹˜ ë“±ì€ CTRì— ìœ ë¦¬í•©ë‹ˆë‹¤.')} else add(null,'SEO ì œëª©ì— ìˆ«ì ì—†ìŒ','ìˆ«ìë¥¼ 1ê°œ í¬í•¨í•˜ë©´ í´ë¦­ë¥  í–¥ìƒì— ë„ì›€.');
  if(descHasKw){score+=8; add(true,'ë©”íƒ€ ì„¤ëª…ì— í‚¤ì›Œë“œ í¬í•¨',`í˜„ì¬ ${descLen}ì (ê¶Œì¥ 100â€“160ì).`)} else add(false,'ë©”íƒ€ ì„¤ëª…ì— í‚¤ì›Œë“œ ì—†ìŒ','ìš”ì•½ë¬¸ì—ë„ í‚¤ì›Œë“œë¥¼ 1íšŒ í¬í•¨í•˜ì„¸ìš”.');
  if(descLen>=100 && descLen<=160){score+=4; add(true,'ë©”íƒ€ ì„¤ëª… ê¸¸ì´ ì ì •',`${descLen}ì`)} else add(null,'ë©”íƒ€ ì„¤ëª… ê¸¸ì´ ë¶€ì ì •',`${descLen}ì (ê¶Œì¥ 100â€“160ì)`);
  if(urlHasKw){score+=5; add(true,'URLì— í‚¤ì›Œë“œ í¬í•¨','ìŠ¬ëŸ¬ê·¸ëŠ” ì§§ê³  ëª…í™•í•˜ê²Œ.')} else add(false,'URLì— í‚¤ì›Œë“œ ì—†ìŒ','ìŠ¬ëŸ¬ê·¸ì— í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ì„¸ìš”.');
  if(slug.length>0 && slug.length<=60){score+=2; add(true,'URL ê¸¸ì´ ì ì •',`${slug.length}ì`)} else add(null,'URL ê¸¸ì´ í™•ì¸',`${slug.length}ì (ê¶Œì¥ â‰¤60ì)`);
  if(first10){score+=6; add(true,'ë³¸ë¬¸ ì²˜ìŒ 10% ì´ë‚´ í‚¤ì›Œë“œ ë…¸ì¶œ','ì´ˆë°˜ ë°°ì¹˜ëŠ” ê²€ìƒ‰ì—”ì§„ ì´í•´ì— ìœ ë¦¬.') } else add(false,'ë³¸ë¬¸ ì´ˆë°˜ í‚¤ì›Œë“œ ë¯¸ë…¸ì¶œ','ë„ì…ë¶€ 2~3ë¬¸ì¥ ì•ˆì— í‚¤ì›Œë“œë¥¼ 1íšŒ í¬í•¨.');
  if(kOcc>0){score+=6; add(true,'ë³¸ë¬¸ì— í‚¤ì›Œë“œ ì¡´ì¬',`${kOcc}íšŒ`)} else add(false,'ë³¸ë¬¸ì— í‚¤ì›Œë“œ ì—†ìŒ','ë³¸ë¬¸ì— ìµœì†Œ 1íšŒ í¬í•¨í•˜ì„¸ìš”.');
  if(hKw>0){score+=6; add(true,'ë¶€ì œëª©(H2/H3)ì— í‚¤ì›Œë“œ í¬í•¨',`${hKw}ê°œ ë¶€ì œëª©ì— í¬í•¨`)} else add(false,'ë¶€ì œëª©ì— í‚¤ì›Œë“œ ì—†ìŒ','H2/H3ì— 1â€“2íšŒ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨.');
  if(altHasKw){score+=4; add(true,'ì´ë¯¸ì§€ ALTì— í‚¤ì›Œë“œ í¬í•¨',`${imgKw}ê°œ ALTì— í¬í•¨`)} else add(null,'ì´ë¯¸ì§€ ALTì— í‚¤ì›Œë“œ ì—†ìŒ','ì£¼ìš” ì´ë¯¸ì§€ ALTì— 1íšŒ í¬í•¨.');
  if(intLinks>0){score+=4; add(true,'ë‚´ë¶€ ë§í¬ í¬í•¨',`${intLinks}ê°œ`)} else add(false,'ë‚´ë¶€ ë§í¬ ì—†ìŒ','ê´€ë ¨ ê¸€ë¡œ ìµœì†Œ 1ê°œ ì—°ê²°.');
  if(extLinks>0){score+=4; add(true,'ì™¸ë¶€ ë§í¬ í¬í•¨',`${extLinks}ê°œ`)} else add(false,'ì™¸ë¶€ ë§í¬ ì—†ìŒ','ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìë£Œ 1ê°œ ì´ìƒ ì—°ê²°.');
  if(doFollowExt>0){score+=2; add(true,'DoFollow ì™¸ë¶€ ë§í¬ í¬í•¨',`${doFollowExt}ê°œ`)} else add(null,'DoFollow ì™¸ë¶€ ë§í¬ ì—†ìŒ','ìµœì†Œ 1ê°œëŠ” dofollow ìœ ì§€.');
  if(wc>=600 && wc<=2500){score+=10; add(true,'ë³¸ë¬¸ ê¸¸ì´ ì ì •',`${wc} ë‹¨ì–´`)} else add(false,'ë³¸ë¬¸ ê¸¸ì´ ë²”ìœ„ ë°–',`${wc} ë‹¨ì–´ (ê¶Œì¥ 600â€“2500)`);
  if(density>=0.8 && density<=1.2){score+=10; add(true,'í‚¤ì›Œë“œ ë°€ë„ ì ì •',`${density.toFixed(2)}%`)} else add(false,'í‚¤ì›Œë“œ ë°€ë„ ë¶€ì ì •',`${density.toFixed(2)}% (ê¶Œì¥ 0.8â€“1.2%)`);
  if(toc){score+=4; add(true,'ëª©ì°¨(ToC) ê°ì§€','[toc] ë˜ëŠ” TOC ë¸”ë¡ ì¡´ì¬')} else add(null,'ëª©ì°¨(ToC) ì—†ìŒ','ê¸´ ê¸€ì´ë©´ [toc]ë¥¼ ì¶”ê°€.');
  if(media){score+=3; add(true,'ì´ë¯¸ì§€/ë¹„ë””ì˜¤ í¬í•¨','ë©€í‹°ë¯¸ë””ì–´ëŠ” ì²´ë¥˜ì‹œê°„ì— ë„ì›€.')} else add(null,'ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì—†ìŒ','ë¯¸ë””ì–´ 1ê°œ ì´ìƒ ì¶”ê°€ ê¶Œì¥.');
  if(pillar){score+=2; add(true,'Pillar Content í”Œë˜ê·¸','í•µì‹¬ í˜ì´ì§€ë¡œ ì„¤ì •ë¨')} else add(null,'Pillar Content ì•„ë‹˜','í•µì‹¬ í—ˆë¸Œë¼ë©´ ì²´í¬.');
  if(!usedBefore){score+=2; add(true,'ì´ í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ ìµœì´ˆ ì‚¬ìš©','í‚¤ì›Œë“œ ì¤‘ë³µ ìµœì†Œí™”')} else add(null,'ì´ì „ì— ì‚¬ìš©í•œ í‚¤ì›Œë“œ','ì¤‘ë³µ ì‚¬ìš©ì€ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.');

  // Grade
  const pct = Math.max(0, Math.min(100, score));
  let grade='C'; let note='ê°œì„  ì—¬ì§€ ìˆìŒ';
  if(pct>=95){grade='A+'; note='íƒì›”í•œ ìµœì í™”'}
  else if(pct>=85){grade='A'; note='ì•„ì£¼ ì¢‹ìŒ'}
  else if(pct>=75){grade='B'; note='ì–‘í˜¸'}
  else if(pct>=65){grade='C'; note='ë³´í†µ'}
  else if(pct>=50){grade='D'; note='ê°œì„  í•„ìš”'}
  else {grade='F'; note='ê·¼ë³¸ ê°œì„  í•„ìš”'}

  // Render KPIs
  $('#score').textContent = Math.round(pct);
  $('#bar').style.width = pct+'%';
  const gradeEl = $('#grade'); gradeEl.textContent = grade; gradeEl.className = 'tag grade-'+(grade==='A+'?'a-plus':grade.toLowerCase());
  $('#gradeNote').textContent = note;
  $('#kpiWords').textContent = wc.toLocaleString();
  $('#kpiDensity').textContent = density.toFixed(2)+'%';
  $('#kpiImages').textContent = imgs.length;
  $('#kpiAlt').textContent = `ALTì— í‚¤ì›Œë“œ ${imgKw}ê°œ`;
  $('#kpiLinks').textContent = `${intLinks} / ${extLinks}`;
  $('#kpiFollow').textContent = `DoFollow ì™¸ë¶€ ${doFollowExt}ê°œ`;
  $('#titleLen').textContent = `${titleLen} chars`;
  $('#descLen').textContent = `${descLen} chars`;

  // Render checklist
  const list = $('#checklist'); list.innerHTML='';
  for(const c of checks){
    const div=document.createElement('div'); div.className='item';
    const status = c.ok===true? 'ok' : (c.ok===false? 'fail' : 'warn');
    div.className = 'item '+status;
    div.innerHTML = `<div class="dot ${status}"></div><div><div class="msg">${c.label}</div>${c.hint?`<div class="hint">${c.hint}</div>`:''}</div>`;
    list.appendChild(div);
  }

  // Raw stats
  const raw = {
    focus, titleLen, descLen, slugLen: slug.length, wordCount: wc, keywordOccurrences: kOcc, headings: hs.length, headingsWithKeyword: hKw,
    images: imgs.length, imagesAltWithKeyword: imgKw, internalLinks:intLinks, externalLinks:extLinks, dofollowExternal: doFollowExt,
    titleHasKw, titleStartsKw, titleHasNum, descHasKw, urlHasKw, keywordInFirst10pct: first10, pillar
  };
  $('#rawStats').textContent = JSON.stringify(raw, null, 2);

  return {pct, grade, checks, raw};
}

// ====== UI Actions ======
function analyzeAndPersist(){ const r=analyze(); localStorage.setItem('pagePulseSEODraft', JSON.stringify(getState())); return r }
function getState(){ return {focus:$('#focus').value,title:$('#title').value,desc:$('#desc').value,slug:$('#slug').value,domain:$('#domain').value,used:$('#usedKeywords').value,pillar:$('#pillar').checked,content:$('#content').value} }
function setState(s){ if(!s) return; $('#focus').value=s.focus||''; $('#title').value=s.title||''; $('#desc').value=s.desc||''; $('#slug').value=s.slug||''; $('#domain').value=s.domain||''; $('#usedKeywords').value=s.used||''; $('#pillar').checked=!!s.pillar; $('#content').value=s.content||''; }

$('#analyze').addEventListener('click', analyzeAndPersist);
['focus','title','desc','slug','domain','usedKeywords','pillar','content'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const evt = (el.tagName === 'INPUT' && el.type === 'checkbox') ? 'change' : 'input';
    el.addEventListener(evt, analyzeAndPersist);
});

$('#makeSlug').addEventListener('click', ()=>{ const t=$('#title').value; $('#slug').value = slugify(t); analyzeAndPersist() });
$('#addToc').addEventListener('click', ()=>{ const c=$('#content'); if(!/\[toc\]/i.test(c.value)){ c.value = '[toc]\n\n' + c.value; } analyzeAndPersist() });
$('#suggestTitle').addEventListener('click', ()=>{
  const k=$('#focus').value.trim(); if(!k){ showToast('í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.','warn'); return; }
  const base = $('#title').value.trim() || k;
  const year = new Date().getFullYear();
  const ideas = [
    `${k}: ${year} ì™„ë²½ ê°€ì´ë“œ (ì²´í¬ë¦¬ìŠ¤íŠ¸ í¬í•¨)`,
    `${k} â€” ${year} ìµœì‹  ì—…ë°ì´íŠ¸ 7ê°€ì§€ í•µì‹¬ í¬ì¸íŠ¸`,
    `${k} ì´ì •ë¦¬: ë†“ì¹˜ê¸° ì‰¬ìš´ 10ê°€ì§€ ì²´í¬`,
    `${k} ì‰½ê²Œ ì •ë¦¬ (ì´ˆë³´ììš© ë‹¨ê³„ë³„ ê°€ì´ë“œ)`
  ];
  let best = ideas[0];
  for(const i of ideas){ if(i.length<=60){ best=i; break } }
  $('#title').value = best; analyzeAndPersist();
});

$('#copyReport').addEventListener('click', ()=>{
  const {pct,grade,raw} = analyze();
  const lines = [
    `Score: ${Math.round(pct)} (${grade})`,
    `ë‹¨ì–´ ìˆ˜: ${raw.wordCount}`,
    `í‚¤ì›Œë“œ ì¶œí˜„: ${raw.keywordOccurrences}íšŒ, ë°€ë„: ${(raw.keywordOccurrences/raw.wordCount*100||0).toFixed(2)}%`,
    `ì œëª©/ì„¤ëª…/URL í‚¤ì›Œë“œ: ${raw.titleHasKw?'O':'X'} / ${raw.descHasKw?'O':'X'} / ${raw.urlHasKw?'O':'X'}`,
    `ì´ˆë°˜ 10% ë…¸ì¶œ: ${raw.keywordInFirst10pct?'O':'X'}`,
    `ë¶€ì œëª© í‚¤ì›Œë“œ: ${raw.headingsWithKeyword}ê°œ / ALT í‚¤ì›Œë“œ: ${raw.imagesAltWithKeyword}ê°œ`,
    `ë‚´ë¶€/ì™¸ë¶€/DoFollow ì™¸ë¶€ ë§í¬: ${raw.internalLinks}/${raw.externalLinks}/${raw.dofollowExternal}`
  ];
  const text = lines.join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('ë¦¬í¬íŠ¸ë¥¼ ë³µì‚¬í–ˆì–´ìš” âœ…','ok')).catch(()=>{showToast('ë³µì‚¬ ì‹¤íŒ¨ â€” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”','warn'); console.log(text);});
});

$('#downloadMd').addEventListener('click', ()=>{
  const {pct,grade,checks,raw} = analyze();
  const md = `# PagePulse SEO Report\n\n- Score: **${Math.round(pct)} (${grade})**\n- Words: **${raw.wordCount}**\n- Keyword occurrences: **${raw.keywordOccurrences}** (density ${(raw.keywordOccurrences/raw.wordCount*100||0).toFixed(2)}%)\n- Title/Meta/URL: ${raw.titleHasKw?'âœ…':'âŒ'} / ${raw.descHasKw?'âœ…':'âŒ'} / ${raw.urlHasKw?'âœ…':'âŒ'}\n- First 10%: ${raw.keywordInFirst10pct?'âœ…':'âŒ'}\n- H2/H3 with KW: **${raw.headingsWithKeyword}**\n- Images with ALT KW: **${raw.imagesAltWithKeyword}** / Total images: ${raw.images}\n- Internal/External/DoFollow ext: **${raw.internalLinks}/${raw.externalLinks}/${raw.dofollowExternal}**\n\n## Checklist\n${checks.map(c=>`- ${c.ok===true?'âœ…':c.ok===false?'âŒ':'âš ï¸'} ${c.label}${c.hint?` â€” ${c.hint}`:''}`).join('\n')}\n`;
  const blob = new Blob([md], {type:'text/markdown'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='pagepulse-seo-report.md'; a.click(); URL.revokeObjectURL(a.href);
});

// Restore draft if any
try{ const saved = JSON.parse(localStorage.getItem('pagePulseSEODraft')||'null'); if(saved){ setState(saved); analyze(); } }catch(e){}

// Starter example
if(!$('#content').value){
  $('#focus').value = 'ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­';
  $('#title').value = 'ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­: 2025 ì™„ë²½ ê°€ì´ë“œ (ì²´í¬ë¦¬ìŠ¤íŠ¸ í¬í•¨)';
  $('#desc').value = '2025ë…„ ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­ ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. ì‹ ì²­ ì¼ì •, ì‚¬ìš©ì²˜, ìœ ì˜ì‚¬í•­ê¹Œì§€ í•œ ë²ˆì— í™•ì¸í•˜ì„¸ìš”.';
  $('#slug').value = 'weekend-application-guide-2025';
  $('#domain').value = 'onnuriinfo.com';
  $('#content').value = '[toc]\n\n## ì‹ ì²­ ëŒ€ìƒê³¼ ì¼ì •\në¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­ì€ ì§€ì—­ë³„ ì¼ì •ì— ë”°ë¼ ì§„í–‰ë˜ë©°, **ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­** í‚¤ì›Œë“œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì •ë³´ë¥¼ ì •ë¦¬í•©ë‹ˆë‹¤. ë‚´ë¶€ ë§í¬ ì˜ˆì‹œ: <a href="/category/government-support">ì •ë¶€ ì§€ì› ì¹´í…Œê³ ë¦¬</a>. ì™¸ë¶€ ë§í¬ ì˜ˆì‹œ: <a href="https://www.gov.kr" rel="noopener">ì •ë¶€24</a>.\n\n## ì¤€ë¹„ ì„œë¥˜\nì‹ ë¶„ì¦, ë³¸ì¸ ëª…ì˜ ì¹´ë“œ, ì‹ ì²­ ê°€ëŠ¥ ì§€ì—­ í™•ì¸ ìë£Œê°€ í•„ìš”í•©ë‹ˆë‹¤. ë‹¤ìŒ ì´ë¯¸ì§€ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤. <img src="idcard.png" alt="ë¯¼ìƒì†Œë¹„ì¿ í° ì£¼ë§ì‹ ì²­ ì¤€ë¹„ì„œë¥˜ ì•ˆë‚´">\n\n## ì‚¬ìš©ì²˜ì™€ ìœ ì˜ì‚¬í•­\nì „í†µì‹œì¥, ì†Œìƒê³µì¸ ë§¤ì¥ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì¼ë¶€ ëŒ€í˜•ë§ˆíŠ¸/ì˜¨ë¼ì¸ëª°ì€ ì œì™¸ë©ë‹ˆë‹¤.\n';
  analyze();
}
</script>

<!-- ===== v1.1 í™•ì¥: Schema, OG/Twitter, Eâ€‘Eâ€‘Aâ€‘T ===== -->
<script>
(function(){
  const grid = document.querySelector('main .grid');
  if(!grid) return;

  function makeCard(title){
    const sec=document.createElement('section');
    sec.className='card';
    sec.innerHTML=`<h2>${title}</h2><div class="small" style="margin-bottom:8px; color:var(--muted)"></div><div class="content"></div>`;
    return sec;
  }
  const schemaCard = makeCard('');
  const ogCard = makeCard('');
  const eeatCard = makeCard('');
  schemaCard.style.gridColumn='span 12';
  ogCard.style.gridColumn='span 6';
  eeatCard.style.gridColumn='span 6';
  if(!document.querySelector('#_schemaCard_')){
    schemaCard.id='_schemaCard_'; ogCard.id='_ogCard_'; eeatCard.id='_eeatCard_';
    grid.appendChild(schemaCard); grid.appendChild(ogCard); grid.appendChild(eeatCard);
  }
  function getDict(){ const lang = window.PP_LANG || 'ko'; return (window.I18N && I18N[lang])? I18N[lang] : I18N.ko; }
  function _applyExtLang(){
    const d = getDict();
    const sH2 = document.querySelector('#_schemaCard_ h2'); if(sH2){ sH2.textContent = d.schema_panel || 'Rich Results & Schema'; sH2.setAttribute('data-i','schema_panel'); }
    const oH2 = document.querySelector('#_ogCard_ h2'); if(oH2){ oH2.textContent = d.og_panel || 'OG/Twitter Meta Generator'; oH2.setAttribute('data-i','og_panel'); }
    const eH2 = document.querySelector('#_eeatCard_ h2'); if(eH2){ eH2.textContent = d.eeat_panel || 'Eâ€‘Eâ€‘Aâ€‘T Checklist'; eH2.setAttribute('data-i','eeat_panel'); }
    const copyBtn = document.querySelector('#_ogCard_ .btn'); if(copyBtn){ copyBtn.textContent = d.copy_meta || 'Copy meta tags'; }
  }
  window._applyExtLang = _applyExtLang;
  const uiLangEl = document.querySelector('#uiLang'); if(uiLangEl){ uiLangEl.addEventListener('change', _applyExtLang) }
  _applyExtLang();

  const getVal = id=> (document.querySelector('#'+id)||{}).value||'';
  const domainFromState = ()=> getVal('domain').trim();
  const slugFromState = ()=> getVal('slug').trim();

  const RULES = {
    FAQPage: { required:['mainEntity'], nested:{ Question:['name','acceptedAnswer'], Answer:['text'] } },
    HowTo: { required:['name','step'] },
    Article: { required:['headline','datePublished'], recommended:['author','image'] },
    Product: { required:['name','offers'], recommended:['sku','brand'] },
    VideoObject: { required:['name','thumbnailUrl'], alt:['contentUrl','embedUrl','uploadDate'] },
    BreadcrumbList: { required:['itemListElement'] }
  };

  function safeJSON(s){ try{ return JSON.parse(s) }catch(e){ return null } }
  function extractJsonLd(html){
    const out=[]; const re=/<script[^>]+type=\"application\/ld\+json\"[^>]*>([\s\S]*?)<\/script>/gi; let m;
    while((m=re.exec(html))) { const j=safeJSON(m[1]); if(!j) continue; const list=Array.isArray(j)?j:[j]; list.forEach(x=>out.push(x)); }
    return out;
  }
  function detectMicrodata(html){
    const hints=[]; const re=/(itemscope)(?=[^>]*itemtype=\"([^\"]+)\")/gi; let m; while((m=re.exec(html))){ hints.push(m[2]) } return hints;
  }
  function typeOf(ent){ const t=ent['@type']; if(!t) return null; return Array.isArray(t)?t[0]:t }
  function hasAll(ent, arr){ return (arr||[]).every(k=> ent[k]!==undefined) }
  function validateEntity(ent){
    const t=typeOf(ent); if(!t || !RULES[t]) return null; const rule=RULES[t];
    const missing=[]; if(rule.required && !hasAll(ent, rule.required)){
      rule.required.forEach(k=>{ if(ent[k]===undefined) missing.push(k) });
    }
    if(t==='FAQPage' && Array.isArray(ent.mainEntity)){
      ent.mainEntity.forEach((q,i)=>{
        if(!hasAll(q, ['@type','name','acceptedAnswer'])) missing.push(`mainEntity[${i}]`);
        if(q.acceptedAnswer && q.acceptedAnswer.text===undefined) missing.push(`acceptedAnswer.text@${i}`);
      });
    }
    if(t==='VideoObject' && !missing.length){
      const alt = (rule.alt||[]).some(k=> ent[k]!==undefined);
      if(!alt) missing.push('contentUrl/embedUrl/uploadDate(ì¤‘ 1)');
    }
    return {type:t, missing};
  }

  function renderSchema(){
    const content = getVal('content');
    const list = extractJsonLd(content);
    const hints = detectMicrodata(content);
    const results=[]; list.forEach(ent=>{ const v=validateEntity(ent); if(v) results.push(v) });
    const root = document.querySelector('#_schemaCard_ .content');
    if(!root) return; root.innerHTML='';

    const summary = document.createElement('div');
    summary.innerHTML = `<div class="row" style="gap:12px;flex-wrap:wrap">
      <span class="tag">JSONâ€‘LD ìŠ¤ë‹ˆí«: ${list.length}ê°œ</span>
      <span class="tag">Microdata íŒíŠ¸: ${hints.length}ê°œ</span>
    </div>`;
    root.appendChild(summary);

    if(!results.length){
      const p=document.createElement('div'); p.className='small'; p.textContent='ê°ì§€ëœ ì§€ì› íƒ€ì… ì—†ìŒ(ë˜ëŠ” í•„ìˆ˜ ì†ì„± ì¶©ì¡±).'; root.appendChild(p);
    } else {
      results.forEach(r=>{
        const div=document.createElement('div'); div.className='item';
        const ok = r.missing.length===0;
        div.innerHTML = `<div class="dot ${ok?'ok':'warn'}"></div>
          <div><div class="msg">@type: <b>${r.type}</b> â€” ${ok?'ìš”ê±´ ì¶©ì¡±':'ëˆ„ë½: '+r.missing.join(', ')}</div>
          <div class="hint">í•„ìˆ˜ ì†ì„±ì€ Google ë¦¬ì¹˜ ê²°ê³¼ ê°€ì´ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°„ì†Œí™”í•œ ì²´í¬ì…ë‹ˆë‹¤.</div></div>`;
        root.appendChild(div);
      });
    }
  }

  function firstImageSrcFromContent(html){
    const m = html.match(/<img[^>]*src=\"([^\"]+)\"/i) || html.match(/!\[[^\]]*\]\(([^\)]+)\)/);
    return m? m[1] : '';
  }
  function canonicalUrl(){
    const dom = domainFromState(); const slug = slugFromState();
    if(dom){
      const proto = /^https?:\/\//i.test(dom)? '' : 'https://';
      return proto + dom.replace(/\/$/,'') + '/' + (slug||'');
    }
    return (location.origin||'') + '/' + (slug||'');
  }
  function buildOgTwitter(){
    const title = getVal('title').trim();
    const desc = getVal('desc').trim();
    const url = canonicalUrl();
    let img = firstImageSrcFromContent(getVal('content'));
    if(!img) img = 'https://example.com/og-default-1200x630.png';
    const meta = [
      `<meta property="og:title" content="${title}">`,
      `<meta property="og:description" content="${desc}">`,
      `<meta property="og:type" content="article">`,
      `<meta property="og:url" content="${url}">`,
      `<meta property="og:image" content="${img}">`,
      `<meta property="og:locale" content="ko_KR">`,
      `<meta name="twitter:card" content="summary_large_image">`,
      `<meta name="twitter:title" content="${title}">`,
      `<meta name="twitter:description" content="${desc}">`,
      `<meta name="twitter:image" content="${img}">`
    ].join('\n');
    return meta;
  }
  function renderOG(){
    const root = document.querySelector('#_ogCard_ .content'); if(!root) return; root.innerHTML='';
    const pre = document.createElement('pre'); pre.className='mono';
    pre.textContent = buildOgTwitter();
    const row = document.createElement('div'); row.className='row'; row.style.marginTop='8px';
    const btn = document.createElement('button'); btn.className='btn'; btn.textContent=(typeof getDict==='function'? (getDict().copy_meta||'ë©”íƒ€ íƒœê·¸ ë³µì‚¬') : 'ë©”íƒ€ íƒœê·¸ ë³µì‚¬');
    btn.onclick=()=>navigator.clipboard.writeText(pre.textContent).then(()=>showToast('ë©”íƒ€ íƒœê·¸ë¥¼ ë³µì‚¬í–ˆì–´ìš” âœ…','ok'));
    row.appendChild(btn); root.appendChild(pre); root.appendChild(row);
  }

  function eeatScore(){
    const content = getVal('content'); const domain = domainFromState();
    const hasAuthor = /(ì‘ì„±ì|author|by\s+[a-zê°€-í£])/i.test(content);
    const hasDate = /\b(20\d{2})[./-](0?[1-9]|1[0-2])[./-](0?[1-9]|[12]\d|3[01])\b/i.test(content) || /(ì—…ë°ì´íŠ¸|ìµœì¢… ìˆ˜ì •)/.test(content);
    const links = (content.match(/<a[^>]*href=\"([^\"]+)\"/gi)||[]).map(x=>x);
    const ext = links.filter(x=>/https?:\/\//i.test(x) && (!domain || !x.includes(domain))).length;
    const contact = /(\/about|\/contact|\/privacy|\/policy)/i.test(content);
    const phone = /(\+?\d{1,3}[-.\s]?)?(0\d{1,2}[-.\s]?\d{3,4}[-.\s]?\d{4})/.test(content);
    const address = /(ì„œìš¸|ê²½ê¸°|ì¸ì²œ|ë¶€ì‚°|ëŒ€êµ¬|ê´‘ì£¼|ëŒ€ì „|ìš¸ì‚°|ì œì£¼|ë„ë¡œëª…|ë²ˆì§€)/.test(content);

    let score=0; const notes=[];
    if(hasAuthor){score+=15}else notes.push('ì €ì ì •ë³´(ì´ë¦„/í”„ë¡œí•„) ì¶”ê°€ ê¶Œì¥');
    if(hasDate){score+=10}else notes.push('ê²Œì‹œ/ìˆ˜ì •ì¼ í‘œê¸°');
    if(ext>=2){score+=20}else notes.push('ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì™¸ë¶€ ì¶œì²˜ 2ê°œ ì´ìƒ ì¸ìš©');
    if(contact){score+=15}else notes.push('About/Contact/ì •ì±… í˜ì´ì§€ ë‚´ë¶€ ë§í¬ ì¶”ê°€');
    if(phone){score+=5}else notes.push('ì—°ë½ì²˜(ì „í™”) ë˜ëŠ” ìƒë‹´ ì±„ë„ í‘œê¸°');
    if(address){score+=5}else notes.push('ì‚¬ì—…ì ì£¼ì†Œ/ì˜¤í”„ë¼ì¸ ì •ë³´ í‘œê¸° ê³ ë ¤');
    const hasMedia = /<img|!\[|<video|<iframe/i.test(content);
    if(hasMedia) score+=10; else notes.push('í•µì‹¬ ì„¹ì…˜ì— ê´€ë ¨ ì´ë¯¸ì§€/ë„í‘œ ì¶”ê°€');
    const words = (content.replace(/<[^>]+>/g,' ').trim().split(/\s+/).filter(Boolean)||[]).length;
    if(words>=800) score+=10; else notes.push('ì¶©ë¶„í•œ ì„¤ëª…(800+ ë‹¨ì–´) ì œê³µ');

    score = Math.min(100, score);
    return {score, notes};
  }
  function renderEEAT(){
    const root = document.querySelector('#_eeatCard_ .content'); if(!root) return; root.innerHTML='';
    const {score, notes} = eeatScore();
    const head = document.createElement('div'); head.innerHTML = `<div class="score">${score}</div>`;
    root.appendChild(head);
    const ul = document.createElement('ul'); ul.className='small';
    notes.forEach(n=>{ const li=document.createElement('li'); li.textContent='â€¢ '+n; ul.appendChild(li) });
    root.appendChild(ul);
  }

  const runAll = ()=>{ try{ renderSchema(); renderOG(); renderEEAT(); }catch(e){ console.warn(e) } };
  const ids=['focus','title','desc','slug','domain','usedKeywords','pillar','content'];
  ids.forEach(id=>{ const el=document.querySelector('#'+id); if(el){ el.addEventListener('input', runAll) }});
  runAll();
})();
</script>
</body>
</html>