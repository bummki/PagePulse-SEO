<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PagePulse SEO â€” On-Page Inspector (Single HTML)</title>
  <meta name="description" content="ì œëª©Â·ë©”íƒ€Â·URLÂ·ë¶€ì œëª©Â·ì´ë¯¸ì§€ ALTÂ·ë§í¬Â·ë°€ë„Â·TOCÂ·ìŠ¤í‚¤ë§ˆÂ·OG/TwitterÂ·E-E-A-Tê¹Œì§€ í•œ ë²ˆì— ì ê²€í•˜ëŠ” ì˜¤í”„ë¼ì¸ ë‹¨ì¼ HTML SEO ì²´ì»¤.">
  <style>
    /* ===== iOS Dark Mode Style ===== */
    :root {
      --bg: #000000;
      --card-bg: #1c1c1e;
      --input-bg: #2c2c2e;
      --border: #38383a;
      --text: rgba(255, 255, 255, 0.95);
      --muted: #8e8e93;
      --accent: #0a84ff;
      --ok: #30d158;
      --warn: #ff9f0a;
      --fail: #ff453a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background-color: var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    header{
      position:sticky;
      top:0;
      z-index:5;
      background:rgba(28, 28, 30, 0.75);
      backdrop-filter:blur(12px) saturate(180%);
      border-bottom: 1px solid var(--border);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-weight:700;letter-spacing:-.2px;margin:0;font-size:1.5rem}
    .sub{color:var(--muted);font-size:.9rem}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:20px}
    .card{
      background-color: var(--card-bg);
      border-radius:16px;
      padding:20px;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .card h2{margin:0 0 16px;font-size:1.1rem; font-weight: 600;}
    label{
      display:block;
      font-size: .75rem;
      color: var(--muted);
      margin: 16px 0 6px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: .5px;
    }
    input,textarea,select{
      width:100%;
      padding:12px 14px;
      border-radius:8px;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      outline:none;
      font-size: 1rem;
      font-family: inherit;
    }
    textarea{min-height:200px;resize:vertical}
    .row{display:flex;gap:12px;flex-wrap:wrap; align-items: center;}
    .btn{
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content: center;
      gap:8px;
      padding:10px 16px;
      border-radius:8px;
      border: none;
      background: var(--input-bg);
      color: var(--text);
      font-size: .9rem;
      font-weight: 600;
      transition: background-color .2s ease;
    }
    .btn:hover{background: #3a3a3c;}
    .btn:active{transform: scale(0.98);}
    .btn.primary{
      background: var(--accent);
      color: #fff;
    }
    .btn.primary:hover{ background: #007aff; }
    .tag{
      padding: 5px 10px;
      border-radius: 999px;
      background-color: var(--input-bg);
      font-size: .8rem;
      color: var(--muted);
    }
    .kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .kpi > div{padding:12px;border-radius:12px;background:var(--input-bg)}
    .kpi .value{font-size:1.4rem;font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:var(--ok)} .dot.warn{background:var(--warn)} .dot.fail{background:var(--fail)}
    .score{font-size:2.8rem;font-weight:800}
    .progress{height:8px;border-radius:999px;background:var(--input-bg);overflow:hidden}
    .bar{height:100%;background:var(--accent)}
    .checklist{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .item{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:12px;background:var(--input-bg)}
    .item .msg{font-size:.9rem}
    .item .hint{color:var(--muted);font-size:.8rem;margin-top:4px}
    .footer{color:var(--muted);font-size:.8rem;margin-top:16px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .lang{margin-left:auto}
    .small{font-size:.8rem;color:var(--muted)}

    /* ===== iOS Toggle Switch ===== */
    .toggle-switch-container { display: flex; align-items: center; gap: 10px; margin: 8px 0 4px; padding: 6px 0;}
    .ios-toggle { position: absolute; opacity: 0; width: 0; height: 0; }
    .toggle-label {
        position: relative;
        display: inline-block;
        width: 51px;
        height: 31px;
        background-color: #39393d;
        border-radius: 34px;
        transition: background-color .3s;
        cursor: pointer;
    }
    .toggle-label::after {
        content: '';
        position: absolute;
        width: 27px;
        height: 27px;
        border-radius: 50%;
        background-color: white;
        top: 2px;
        left: 2px;
        transition: transform .3s;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    .ios-toggle:checked + .toggle-label { background-color: var(--accent); }
    .ios-toggle:checked + .toggle-label::after { transform: translateX(20px); }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .checklist{grid-template-columns:1fr}
      .kpi{grid-template-columns:repeat(2,1fr)}
      textarea{min-height:180px}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap row" style="align-items:center;">
    <h1>PagePulse SEO <span class="sub">â€” On-Page Inspector</span></h1>
    <div class="lang row" style="align-items:flex-end; gap:8px">
      <label for="uiLang" data-i="language_label" style="margin:0; text-transform:none; font-size:.8rem;">UI Language</label>
      <select id="uiLang">
        <option value="ko">í•œêµ­ì–´</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="zh">ä¸­æ–‡</option>
        <option value="es">EspaÃ±ol</option>
      </select>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card" style="grid-column: span 7;">
      <h2 data-i="content_input">Content Input</h2>
      <div>
        <label data-i="focus_keyword">Focus Keyword</label>
        <input id="focus" placeholder="" />
      </div>
      <div class="grid-2">
        <div>
          <label data-i="site_domain">Site Domain</label>
          <input id="domain" placeholder="" />
        </div>
        <div>
          <label data-i="prev_keywords">Previously Used Keywords</label>
          <input id="usedKeywords" placeholder="" />
        </div>
      </div>
      <label data-i="seo_title">SEO Title</label>
              <input id="title" placeholder="" />
      <div class="row" style="margin-top:8px">
        <button class="btn" id="suggestTitle">ğŸ”® <span data-i="suggest_title">ì œëª© ê°œì„ </span></button>
        <span class="tag" id="titleLen">0 chars</span>
      </div>
      <label data-i="meta_desc">Meta Description</label>
              <textarea id="desc" placeholder=""></textarea>
      <div class="row" style="margin-top:8px">
        <span class="tag" id="descLen">0 chars</span>
      </div>
      <label data-i="url_slug">URL Slug</label>
              <input id="slug" placeholder="" />
      
      <div class="toggle-switch-container">
        <input type="checkbox" id="pillar" class="ios-toggle" />
        <label for="pillar" class="toggle-label"></label>
        <span data-i="pillar">ì´ ê²Œì‹œë¬¼ì€ Pillar Contentì…ë‹ˆë‹¤</span>
      </div>
      
      <label data-i="main_content">Main Content (HTML or Markdown)</label>
              <textarea id="content" placeholder=""></textarea>
      <div class="row" style="margin-top:16px; justify-content:space-between;">
        <div class="row">
            <button class="btn primary" id="analyze">âœ… <span data-i="run_check">ì‹¤ì‹œê°„ ë¶„ì„</span></button>
            <button class="btn" id="copyReport">ğŸ“‹ <span data-i="copy_report">ë¦¬í¬íŠ¸ ë³µì‚¬</span></button>
            <button class="btn" id="downloadMd">â¬‡ï¸ <span data-i="download_md">Markdown ì €ì¥</span></button>
        </div>
        <div class="row">
            <button class="btn" id="makeSlug">ğŸ”§ <span data-i="make_slug">ìŠ¬ëŸ¬ê·¸ ìƒì„±</span></button>
            <button class="btn" id="addToc">ğŸ§­ <span data-i="insert_toc">[toc] ì‚½ì…</span></button>
        </div>
      </div>
    </section>

    <section class="card" style="grid-column: span 5;">
      <h2 data-i="score">Score</h2>
      <div class="row" style="align-items:center; gap:16px">
        <div class="score" id="score">0</div>
        <div style="flex:1">
          <div class="progress"><div class="bar" id="bar" style="width:0%"></div></div>
          <div class="small" id="gradeNote" style="margin-top:8px">â€”</div>
        </div>
      </div>
      <div class="kpi" style="margin-top:20px">
        <div>
          <div class="small" data-i="kpi_words">ë‹¨ì–´ ìˆ˜</div>
          <div class="value" id="kpiWords">0</div>
        </div>
        <div>
          <div class="small" data-i="kpi_density">í‚¤ì›Œë“œ ë°€ë„</div>
          <div class="value" id="kpiDensity">0%</div>
        </div>
        <div>
          <div class="small" data-i="kpi_images">ì´ë¯¸ì§€</div>
          <div class="value" id="kpiImages">0</div>
        </div>
        <div>
          <div class="small" data-i="kpi_links">ë§í¬</div>
          <div class="value" id="kpiLinks">0 / 0</div>
        </div>
      </div>
    </section>

    <section class="card" style="grid-column: span 12;">
      <h2 data-i="checklist">Checklist</h2>
      <div class="checklist" id="checklist"></div>
    </section>
  </div>
</main>

<script>
// ====== i18n (ê°„ë‹¨ ì‚¬ì „) ======
const I18N = {
  ko:{content_input:"ì½˜í…ì¸  ì…ë ¥", focus_keyword:"í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ", site_domain:"ì‚¬ì´íŠ¸ ë„ë©”ì¸", seo_title:"SEO ì œëª©", suggest_title:"ì œëª© ê°œì„ ", meta_desc:"ë©”íƒ€ ì„¤ëª…", url_slug:"URL ìŠ¬ëŸ¬ê·¸", prev_keywords:"ì´ì „ì— ì‚¬ìš©í•œ í‚¤ì›Œë“œ", pillar:"ì´ ê²Œì‹œë¬¼ì€ Pillar Contentì…ë‹ˆë‹¤", make_slug:"ìŠ¬ëŸ¬ê·¸ ìƒì„±", insert_toc:"[toc] ì‚½ì…", main_content:"ë³¸ë¬¸ (HTML/Markdown)", run_check:"ì‹¤ì‹œê°„ ë¶„ì„", copy_report:"ë¦¬í¬íŠ¸ ë³µì‚¬", download_md:"Markdown ì €ì¥", kpi_words:"ë‹¨ì–´ ìˆ˜", kpi_density:"í‚¤ì›Œë“œ ë°€ë„", kpi_images:"ì´ë¯¸ì§€", kpi_links:"ë§í¬",
      score:"ì ìˆ˜", checklist:"ì²´í¬ë¦¬ìŠ¤íŠ¸", step_by_step:"ë‹¨ê³„ë³„ ê°€ì´ë“œ", details:"ì„¸ë¶€ ì§€í‘œ", language_label:"UI ì–¸ì–´", schema_panel:"ë¦¬ì¹˜ ê²°ê³¼ & ìŠ¤í‚¤ë§ˆ", og_panel:"OG/Twitter ë©”íƒ€ ìƒì„±ê¸°", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T ì²´í¬ë¦¬ìŠ¤íŠ¸", copy_meta:"ë©”íƒ€ íƒœê·¸ ë³µì‚¬"},
  en:{content_input:"Content Input", focus_keyword:"Focus Keyword", site_domain:"Site Domain", seo_title:"SEO Title", suggest_title:"Improve Title", meta_desc:"Meta Description", url_slug:"URL Slug", prev_keywords:"Previously Used Keywords", pillar:"This post is Pillar Content", make_slug:"Make Slug", insert_toc:"Insert [toc]", main_content:"Main Content (HTML/Markdown)", run_check:"Live Analyze", copy_report:"Copy Report", download_md:"Save Markdown", kpi_words:"Word Count", kpi_density:"Keyword Density", kpi_images:"Images", kpi_links:"Links",
      score:"Score", checklist:"Checklist", step_by_step:"Step-by-Step (Guide)", details:"Details", language_label:"UI Language", schema_panel:"Rich Results & Schema", og_panel:"OG/Twitter Meta Generator", eeat_panel:"Eâ€‘Eâ€‘Aâ€‘T Checklist", copy_meta:"Copy meta tags"},
  ja:{content_input:"ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥åŠ›", focus_keyword:"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", site_domain:"ã‚µã‚¤ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³", seo_title:"SEOã‚¿ã‚¤ãƒˆãƒ«", suggest_title:"ã‚¿ã‚¤ãƒˆãƒ«æ”¹å–„", meta_desc:"ãƒ¡ã‚¿ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³", url_slug:"URLã‚¹ãƒ©ãƒƒã‚°", prev_keywords:"éå»ã«ä½¿ç”¨ã—ãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", pillar:"ã“ã®æŠ•ç¨¿ã¯ãƒ”ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„", make_slug:"ã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆ", insert_toc:"[toc] æŒ¿å…¥", main_content:"æœ¬æ–‡ (Markdown / HTML)", run_check:"ãƒ©ã‚¤ãƒ–åˆ†æ", copy_report:"ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼", download_md:"Markdown ä¿å­˜", kpi_words:"å˜èªæ•°", kpi_density:"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯†åº¦", kpi_images:"ç”»åƒ", kpi_links:"ãƒªãƒ³ã‚¯",
      score:"ã‚¹ã‚³ã‚¢", checklist:"ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ", language_label:"UI è¨€èª"},
  zh:{content_input:"å†…å®¹è¾“å…¥", focus_keyword:"ç„¦ç‚¹å…³é”®è¯", site_domain:"ç«™ç‚¹åŸŸå", seo_title:"SEO æ ‡é¢˜", suggest_title:"ä¼˜åŒ–æ ‡é¢˜", meta_desc:"å…ƒæè¿°", url_slug:"URL åˆ«å", prev_keywords:"ä»¥å¾€ç”¨è¿‡çš„å…³é”®è¯", pillar:"æ­¤æ–‡ä¸ºæ”¯æŸ±å†…å®¹", make_slug:"ç”Ÿæˆåˆ«å", insert_toc:"æ’å…¥ [toc]", main_content:"æ­£æ–‡ (Markdown/HTML)", run_check:"å®æ—¶åˆ†æ", copy_report:"å¤åˆ¶æŠ¥å‘Š", download_md:"ä¿å­˜ Markdown", kpi_words:"å­—æ•°", kpi_density:"å…³é”®è¯å¯†åº¦", kpi_images:"å›¾ç‰‡", kpi_links:"é“¾æ¥",
      score:"åˆ†æ•°", checklist:"æ£€æŸ¥æ¸…å•", language_label:"ç•Œé¢è¯­è¨€"},
  es:{content_input:"Entrada de contenido", focus_keyword:"Palabra clave principal", site_domain:"Dominio del sitio", seo_title:"TÃ­tulo SEO", suggest_title:"Mejorar tÃ­tulo", meta_desc:"Meta descripciÃ³n", url_slug:"Slug de URL", prev_keywords:"Palabras clave usadas antes", pillar:"Este artÃ­culo es Pilar", make_slug:"Crear Slug", insert_toc:"Insertar [toc]", main_content:"Cuerpo (Markdown/HTML)", run_check:"AnÃ¡lisis en vivo", copy_report:"Copiar informe", download_md:"Guardar Markdown", kpi_words:"NÂº de palabras", kpi_density:"Densidad", kpi_images:"ImÃ¡genes", kpi_links:"Enlaces",
      score:"PuntuaciÃ³n", checklist:"Lista de verificaciÃ³n", language_label:"Idioma"}
};
const $ = s=>document.querySelector(s);
const $$ = s=>Array.from(document.querySelectorAll(s));
function setLang(lang){
  const dict = I18N[lang]||I18N.ko;
  window.PP_LANG = lang;
  $$('[data-i]').forEach(el=>{
    const k=el.getAttribute('data-i');
    if(dict[k]) el.textContent=dict[k]
  });

}
$('#uiLang').addEventListener('change',e=>setLang(e.target.value));
setLang('ko');

// ====== Helpers ======
function showToast(message,type='ok'){
  const el=document.createElement('div');
  el.className='toast '+type;
  el.setAttribute('role','status');
  el.setAttribute('aria-live','polite');
  el.textContent=message;
  document.body.appendChild(el);
  setTimeout(()=>{el.classList.add('show')},10);
  setTimeout(()=>{el.classList.remove('show'); el.addEventListener('transitionend',()=>el.remove(),{once:true})},2500);
}
const stripHtml = (html)=>html.replace(/<script[\s\S]*?<\/script>/gi,'').replace(/<style[\s\S]*?<\/style>/gi,'').replace(/<[^>]+>/g,' ');
const getWords = (txt)=> (txt||'').trim().split(/\s+|(?<![ê°€-í£A-Za-z0-9])(?=[ê°€-í£A-Za-z0-9])/u).filter(Boolean);
const wordCount = (txt)=> getWords(stripHtml(txt)).length;
const occ = (text, kw)=>{ if(!kw) return 0; const t=(text||'').toLowerCase(); const k=kw.toLowerCase().trim(); return (t.match(new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'))||[]).length }
const slugify = s=> (s||'').toString().trim().toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9\-ê°€-í£]/g,'-').replace(/-+/g,'-').replace(/^-|-$/g,'');
const inFirstTenPercent = (text, kw)=>{
  const words = getWords(stripHtml(text)); if(!kw||words.length===0) return false; const idx = words.join(' ').toLowerCase().indexOf(kw.toLowerCase()); if(idx<0) return false; const tenth = Math.floor(stripHtml(text).length*0.1); return idx <= tenth;
}
function parseImages(content){
  const html = content; const imgs=[];
  for(const m of html.matchAll(/<img[^>]*alt\s*=\s*"([^"]*)"[^>]*>/gi)){ imgs.push({alt:m[1]}) }
  for(const m of html.matchAll(/!\[([^\]]*)\]\(([^\)]+)\)/g)){ imgs.push({alt:m[1]}) }
  return imgs;
}
function parseLinks(content){
  const links=[]; const d=$('#domain').value.trim();
  for(const m of content.matchAll(/<a[^>]*href\s*=\s*"([^"]+)"[^>]*?(rel\s*=\s*"([^"]*)")?[^>]*>/gi)){
    const href = m[1]; const rel = (m[3]||'').toLowerCase(); const isExternal = /^https?:\/\//i.test(href) && (!d || !href.includes(d));
    const isInternal = d? href.includes(d) || /^\//.test(href) : !/^https?:\/\//i.test(href) || /^\//.test(href);
    links.push({href, isExternal, isInternal, dofollow: isExternal && !/nofollow/.test(rel)})
  }
  for(const m of content.matchAll(/\[[^\]]*\]\(([^\)]+)\)/g)){
    const href=m[1]; const isExternal = /^https?:\/\//i.test(href) && (!d || !href.includes(d));
    const isInternal = d? href.includes(d) || /^\//.test(href) : !/^https?:\/\//i.test(href) || /^\//.test(href);
    links.push({href, isExternal, isInternal, dofollow:isExternal})
  }
  return links;
}
function parseHeadings(content){
  const hs=[];
  for(const m of content.matchAll(/<h([23])[^>]*>([\s\S]*?)<\/h\1>/gi)){ hs.push({level:+m[1], text: m[2].replace(/<[^>]+>/g,'').trim()}) }
  for(const m of content.matchAll(/^\s*#{2,3}\s+(.+)$/gmi)){ const hashes=(m[0].match(/#/g)||[]).length; hs.push({level:hashes, text:m[1].trim()}) }
  return hs;
}
function hasTOC(content){ return /\[toc\]/i.test(content) || /<nav[^>]*class\s*=\s*"[^"]*toc[^"]*"/i.test(content) }
function hasMedia(content){ return /<img|!\[|<video|<iframe/i.test(content) }

function analyze(){
  const focus=$('#focus').value.trim();
  const title=$('#title').value||'';
  const desc=$('#desc').value||'';
  const slug=$('#slug').value.trim();
  const used = ($('#usedKeywords').value||'').split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
  const pillar = $('#pillar').checked;
  const content = $('#content').value||'';
  
  // í¬ì»¤ìŠ¤ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ëª¨ë“  ì²´í¬ë¥¼ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬
  if(!focus) {
    const list = $('#checklist'); 
    list.innerHTML='';
    $('#score').textContent = '0';
    $('#bar').style.width = '0%';
    $('#gradeNote').textContent = 'í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”';
    $('#kpiWords').textContent = '0';
    $('#kpiDensity').textContent = '0%';
    $('#kpiImages').textContent = '0';
    $('#kpiLinks').textContent = '0 / 0';
    $('#titleLen').textContent = '0 chars';
    $('#descLen').textContent = '0 chars';
    
    return {
      pct: 0,
      grade: 'F',
      checks: [],
      raw: {
        wordCount: 0,
        keywordOccurrences: 0,
        keywordDensity: 0,
        titleHasKw: false,
        descHasKw: false,
        urlHasKw: false,
        keywordInFirst10pct: false
      }
    };
  }

  const text = stripHtml(content);
  const wc = wordCount(content);
  const kOcc = occ(text, focus);
  const density = wc? (kOcc / wc * 100):0;
  const imgs = parseImages(content);
  const imgKw = imgs.filter(i=> (i.alt||'').toLowerCase().includes(focus.toLowerCase())).length;
  const links = parseLinks(content);
  const intLinks = links.filter(l=>l.isInternal).length;
  const extLinks = links.filter(l=>l.isExternal).length;
  const doFollowExt = links.filter(l=>l.isExternal && l.dofollow).length;
  const hs = parseHeadings(content);
  const hKw = hs.filter(h=> h.text.toLowerCase().includes(focus.toLowerCase())).length;
  const first10 = inFirstTenPercent(content, focus);
  const urlHasKw = slug.toLowerCase().includes(focus.toLowerCase());
  const titleHasKw = title.toLowerCase().includes(focus.toLowerCase());
  const titleStartsKw = title.trim().toLowerCase().startsWith(focus.toLowerCase());
  const titleHasNum = /\d/.test(title);
  const titleLen = title.length;
  const descHasKw = desc.toLowerCase().includes(focus.toLowerCase());
  const descLen = desc.length;
  const toc = hasTOC(content);
  const media = hasMedia(content);
  const usedBefore = used.includes(focus.toLowerCase());
  const altHasKw = imgKw>0;

  let score=0; const checks=[]; const add=(ok,label,hint='')=>{checks.push({ok,label,hint})}
  if(titleHasKw){score+=10; add(true,'SEO ì œëª©ì— í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ í¬í•¨','í‚¤ì›Œë“œëŠ” ì œëª© ì•ìª½ì— ë°°ì¹˜í•˜ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.')} else {score+=0; add(false,'SEO ì œëª©ì— í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ ì—†ìŒ',`ìˆ˜ì • ì œì•ˆ: "${focus}"ë¥¼ í¬í•¨í•œ ì œëª©ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”. ì˜ˆì‹œ: "${focus} ì™„ë²½ ê°€ì´ë“œ"`);}
  if(titleStartsKw){score+=5; add(true,'SEO ì œëª©ì˜ ì•ìª½ì— í‚¤ì›Œë“œ','ê°€ëŠ¥í•˜ë‹¤ë©´ í‚¤ì›Œë“œë¡œ ì‹œì‘í•˜ì„¸ìš”.')} else {score+=0; add(false,'SEO ì œëª©ì˜ ì•ìª½ì— í‚¤ì›Œë“œ ì•„ë‹˜',`ìˆ˜ì • ì œì•ˆ: ì œëª©ì„ "${focus}"ë¡œ ì‹œì‘í•˜ì„¸ìš”. ì˜ˆì‹œ: "${focus}: ${title || 'ì™„ë²½ ê°€ì´ë“œ'}"`);}
  if(titleHasNum){score+=3; add(true,'SEO ì œëª©ì— ìˆ«ì í¬í•¨','ë¦¬ìŠ¤íŠ¸/ì—°ë„/ìˆ˜ì¹˜ ë“±ì€ CTRì— ìœ ë¦¬í•©ë‹ˆë‹¤.')} else {score+=0; add(false,'SEO ì œëª©ì— ìˆ«ì ì—†ìŒ',`ìˆ˜ì • ì œì•ˆ: ì œëª©ì— ìˆ«ìë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ì˜ˆì‹œ: "${title || focus} 10ê°€ì§€ íŒ" ë˜ëŠ” "${title || focus} 2025ë…„ ê°€ì´ë“œ"`);}
  if(descHasKw){score+=8; add(true,'ë©”íƒ€ ì„¤ëª…ì— í‚¤ì›Œë“œ í¬í•¨',`í˜„ì¬ ${descLen}ì (ê¶Œì¥ 100â€“160ì).`)} else {score+=0; add(false,'ë©”íƒ€ ì„¤ëª…ì— í‚¤ì›Œë“œ ì—†ìŒ',`ìˆ˜ì • ì œì•ˆ: ë©”íƒ€ ì„¤ëª…ì— "${focus}"ë¥¼ í¬í•¨í•˜ì„¸ìš”. ì˜ˆì‹œ: "${focus}ì— ëŒ€í•œ ìƒì„¸í•œ ì •ë³´ì™€ ì‹¤ìš©ì ì¸ íŒì„ ì œê³µí•©ë‹ˆë‹¤. ${desc || 'ì´ ê¸€ì„ í†µí•´ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ì–»ìœ¼ì„¸ìš”.'}"`);}
  if(descLen>=100 && descLen<=160){score+=4; add(true,'ë©”íƒ€ ì„¤ëª… ê¸¸ì´ ì ì •',`${descLen}ì`)} else {score+=0; add(false,'ë©”íƒ€ ì„¤ëª… ê¸¸ì´ ë¶€ì ì •',`${descLen}ì (ê¶Œì¥ 100â€“160ì)`);}
  if(urlHasKw){score+=5; add(true,'URLì— í‚¤ì›Œë“œ í¬í•¨','ìŠ¬ëŸ¬ê·¸ëŠ” ì§§ê³  ëª…í™•í•˜ê²Œ.')} else {score+=0; add(false,'URLì— í‚¤ì›Œë“œ ì—†ìŒ',`ìˆ˜ì • ì œì•ˆ: URL ìŠ¬ëŸ¬ê·¸ì— "${focus}"ë¥¼ í¬í•¨í•˜ì„¸ìš”. ì˜ˆì‹œ: "${focus}-guide" ë˜ëŠ” "${focus}-tips"`);}
  if(slug.length>0 && slug.length<=60){score+=2; add(true,'URL ê¸¸ì´ ì ì •',`${slug.length}ì`)} else {score+=0; add(false,'URL ê¸¸ì´ í™•ì¸',`${slug.length}ì (ê¶Œì¥ â‰¤60ì)`);}
  if(first10){score+=6; add(true,'ë³¸ë¬¸ ì²˜ìŒ 10% ì´ë‚´ í‚¤ì›Œë“œ ë…¸ì¶œ','ì´ˆë°˜ ë°°ì¹˜ëŠ” ê²€ìƒ‰ì—”ì§„ ì´í•´ì— ìœ ë¦¬.') } else {score+=0; add(false,'ë³¸ë¬¸ ì´ˆë°˜ í‚¤ì›Œë“œ ë¯¸ë…¸ì¶œ','ë„ì…ë¶€ 2~3ë¬¸ì¥ ì•ˆì— í‚¤ì›Œë“œë¥¼ 1íšŒ í¬í•¨.');}
  if(kOcc>0){score+=6; add(true,'ë³¸ë¬¸ì— í‚¤ì›Œë“œ ì¡´ì¬',`${kOcc}íšŒ`)} else {score+=0; add(false,'ë³¸ë¬¸ì— í‚¤ì›Œë“œ ì—†ìŒ','ë³¸ë¬¸ì— ìµœì†Œ 1íšŒ í¬í•¨í•˜ì„¸ìš”.');}
  if(hKw>0){score+=6; add(true,'ë¶€ì œëª©(H2/H3)ì— í‚¤ì›Œë“œ í¬í•¨',`${hKw}ê°œ ë¶€ì œëª©ì— í¬í•¨`)} else {score+=0; add(false,'ë¶€ì œëª©ì— í‚¤ì›Œë“œ ì—†ìŒ','H2/H3ì— 1â€“2íšŒ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨.');}
  if(altHasKw){score+=4; add(true,'ì´ë¯¸ì§€ ALTì— í‚¤ì›Œë“œ í¬í•¨',`${imgKw}ê°œ ALTì— í¬í•¨`)} else {score+=0; add(false,'ì´ë¯¸ì§€ ALTì— í‚¤ì›Œë“œ ì—†ìŒ','ì£¼ìš” ì´ë¯¸ì§€ ALTì— 1íšŒ í¬í•¨.');}
  if(intLinks>0){score+=4; add(true,'ë‚´ë¶€ ë§í¬ í¬í•¨',`${intLinks}ê°œ`)} else {score+=0; add(false,'ë‚´ë¶€ ë§í¬ ì—†ìŒ','ê´€ë ¨ ê¸€ë¡œ ìµœì†Œ 1ê°œ ì—°ê²°.');}
  if(extLinks>0){score+=4; add(true,'ì™¸ë¶€ ë§í¬ í¬í•¨',`${extLinks}ê°œ`)} else {score+=0; add(false,'ì™¸ë¶€ ë§í¬ ì—†ìŒ','ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìë£Œ 1ê°œ ì´ìƒ ì—°ê²°.');}
  if(doFollowExt>0){score+=2; add(true,'DoFollow ì™¸ë¶€ ë§í¬ í¬í•¨',`${doFollowExt}ê°œ`)} else {score+=0; add(false,'DoFollow ì™¸ë¶€ ë§í¬ ì—†ìŒ','ìµœì†Œ 1ê°œëŠ” dofollow ìœ ì§€.');}
  if(wc>=600 && wc<=2500){score+=10; add(true,'ë³¸ë¬¸ ê¸¸ì´ ì ì •',`${wc} ë‹¨ì–´`)} else {score+=0; add(false,'ë³¸ë¬¸ ê¸¸ì´ ë²”ìœ„ ë°–',`${wc} ë‹¨ì–´ (ê¶Œì¥ 600â€“2500)`);}
  if(density>=0.8 && density<=1.2){score+=10; add(true,'í‚¤ì›Œë“œ ë°€ë„ ì ì •',`${density.toFixed(2)}%`)} else {score+=0; add(false,'í‚¤ì›Œë“œ ë°€ë„ ë¶€ì ì •',`${density.toFixed(2)}% (ê¶Œì¥ 0.8â€“1.2%)`);}
  if(toc){score+=4; add(true,'ëª©ì°¨(ToC) ê°ì§€','[toc] ë˜ëŠ” TOC ë¸”ë¡ ì¡´ì¬')} else {score+=0; add(false,'ëª©ì°¨(ToC) ì—†ìŒ','ê¸´ ê¸€ì´ë©´ [toc]ë¥¼ ì¶”ê°€.');}
  if(media){score+=3; add(true,'ì´ë¯¸ì§€/ë¹„ë””ì˜¤ í¬í•¨','ë©€í‹°ë¯¸ë””ì–´ëŠ” ì²´ë¥˜ì‹œê°„ì— ë„ì›€.')} else {score+=0; add(false,'ì´ë¯¸ì§€/ë¹„ë””ì˜¤ ì—†ìŒ','ë¯¸ë””ì–´ 1ê°œ ì´ìƒ ì¶”ê°€ ê¶Œì¥.');}
  if(pillar){score+=2; add(true,'Pillar Content í”Œë˜ê·¸','í•µì‹¬ í˜ì´ì§€ë¡œ ì„¤ì •ë¨')} else {score+=0; add(false,'Pillar Content ì•„ë‹˜','í•µì‹¬ í—ˆë¸Œë¼ë©´ ì²´í¬.');}
  if(!usedBefore){score+=2; add(true,'ì´ í¬ì»¤ìŠ¤ í‚¤ì›Œë“œ ìµœì´ˆ ì‚¬ìš©','í‚¤ì›Œë“œ ì¤‘ë³µ ìµœì†Œí™”')} else {score+=0; add(false,'ì´ì „ì— ì‚¬ìš©í•œ í‚¤ì›Œë“œ','ì¤‘ë³µ ì‚¬ìš©ì€ í”¼í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.');}

  const pct = Math.max(0, Math.min(100, score));
  let grade='C'; let note='ê°œì„  ì—¬ì§€ ìˆìŒ';
  if(pct>=95){grade='A+'; note='íƒì›”í•œ ìµœì í™”'}
  else if(pct>=85){grade='A'; note='ì•„ì£¼ ì¢‹ìŒ'}
  else if(pct>=75){grade='B'; note='ì–‘í˜¸'}
  else if(pct>=65){grade='C'; note='ë³´í†µ'}
  else if(pct>=50){grade='D'; note='ê°œì„  í•„ìš”'}
  else {grade='F'; note='ê·¼ë³¸ ê°œì„  í•„ìš”'}

  $('#score').textContent = Math.round(pct);
  $('#bar').style.width = pct+'%';
  $('#gradeNote').textContent = note;
  $('#kpiWords').textContent = wc.toLocaleString();
  $('#kpiDensity').textContent = density.toFixed(2)+'%';
  $('#kpiImages').textContent = imgs.length;
  $('#kpiLinks').textContent = `${intLinks} / ${extLinks}`;
  $('#titleLen').textContent = `${titleLen} chars`;
  $('#descLen').textContent = `${descLen} chars`;

  const list = $('#checklist'); list.innerHTML='';
  for(const c of checks){
    const div=document.createElement('div');
    const status = c.ok===true? 'ok' : (c.ok===false? 'fail' : 'warn');
    div.className = 'item';
    div.innerHTML = `<div class="dot ${status}"></div><div><div class="msg">${c.label}</div>${c.hint?`<div class="hint">${c.hint}</div>`:''}</div>`;
    list.appendChild(div);
  }
  
  // í•„ìš”í•œ ë°ì´í„° ë°˜í™˜
  return {
    pct,
    grade,
    checks,
    raw: {
      wordCount: wc,
      keywordOccurrences: kOcc,
      keywordDensity: density,
      titleHasKw,
      descHasKw,
      urlHasKw,
      keywordInFirst10pct: first10
    }
  };
}

function analyzeAndPersist(){ const r=analyze(); localStorage.setItem('pagePulseSEODraft', JSON.stringify(getState())); return r }
function getState(){ return {focus:$('#focus').value,title:$('#title').value,desc:$('#desc').value,slug:$('#slug').value,domain:$('#domain').value,used:$('#usedKeywords').value,pillar:$('#pillar').checked,content:$('#content').value} }
function setState(s){ if(!s) return; $('#focus').value=s.focus||''; $('#title').value=s.title||''; $('#desc').value=s.desc||''; $('#slug').value=s.slug||''; $('#domain').value=s.domain||''; $('#usedKeywords').value=s.used||''; $('#pillar').checked=!!s.pillar; $('#content').value=s.content||''; }

$('#analyze').addEventListener('click', analyzeAndPersist);
['focus','title','desc','slug','domain','usedKeywords','pillar','content'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    const evt = (el.tagName === 'INPUT' && el.type === 'checkbox') ? 'change' : 'input';
    el.addEventListener(evt, analyzeAndPersist);
});

$('#makeSlug').addEventListener('click', ()=>{
  const title = $('#title').value.trim();
  const focus = $('#focus').value.trim();
  
  if (!title && !focus) {
    showToast('ì œëª©ì´ë‚˜ í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.', 'warn');
    return;
  }
  
  let slugText = title || focus;
  if (title && focus && !title.toLowerCase().includes(focus.toLowerCase())) {
    // ì œëª©ì— í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì§€ ì•Šì€ ê²½ìš° í‚¤ì›Œë“œë¥¼ ì•ì— ì¶”ê°€
    slugText = `${focus}-${title}`;
  }
  
  $('#slug').value = slugify(slugText);
  analyzeAndPersist();
});
$('#addToc').addEventListener('click', ()=>{ const c=$('#content'); if(!/\[toc\]/i.test(c.value)){ c.value = '[toc]\n\n' + c.value; } analyzeAndPersist() });
$('#suggestTitle').addEventListener('click', ()=>{
  const k=$('#focus').value.trim(); if(!k){ showToast('í¬ì»¤ìŠ¤ í‚¤ì›Œë“œë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.','warn'); return; }
  const base = $('#title').value.trim() || k;
  const year = new Date().getFullYear();
  const ideas = [
    `${k}: ${year} ì™„ë²½ ê°€ì´ë“œ`,
    `${k} â€” ${year} ìµœì‹  ì—…ë°ì´íŠ¸ 7ê°€ì§€`,
    `${k} ì´ì •ë¦¬: 10ê°€ì§€ ì²´í¬ë¦¬ìŠ¤íŠ¸`,
    `${k} ì´ˆë³´ììš© ë‹¨ê³„ë³„ ê°€ì´ë“œ`
  ];
  let best = ideas[0];
  for(const i of ideas){ if(i.length<=60){ best=i; break } }
  $('#title').value = best; analyzeAndPersist();
});

$('#copyReport').addEventListener('click', ()=>{
  const result = analyze();
  const lines = [ `Score: ${Math.round(result.pct)} (${result.grade})`, `ë‹¨ì–´ ìˆ˜: ${result.raw.wordCount}`, `í‚¤ì›Œë“œ ì¶œí˜„: ${result.raw.keywordOccurrences}íšŒ, ë°€ë„: ${(result.raw.keywordOccurrences/result.raw.wordCount*100||0).toFixed(2)}%`, `ì œëª©/ì„¤ëª…/URL í‚¤ì›Œë“œ: ${result.raw.titleHasKw?'O':'X'} / ${result.raw.descHasKw?'O':'X'} / ${result.raw.urlHasKw?'O':'X'}`, `ì´ˆë°˜ 10% ë…¸ì¶œ: ${result.raw.keywordInFirst10pct?'O':'X'}`];
  const text = lines.join('\n');
  navigator.clipboard.writeText(text).then(()=>showToast('ë¦¬í¬íŠ¸ë¥¼ ë³µì‚¬í–ˆì–´ìš” âœ…','ok')).catch(()=>showToast('ë³µì‚¬ ì‹¤íŒ¨','warn'));
});

$('#downloadMd').addEventListener('click', ()=>{
  const result = analyze();
  const md = `# PagePulse SEO Report\n\n- Score: **${Math.round(result.pct)} (${result.grade})**\n\n## Checklist\n${result.checks.map(c=>`- ${c.ok===true?'âœ…':c.ok===false?'âŒ':'âš ï¸'} ${c.label}${c.hint?` â€” ${c.hint}`:''}`).join('\n')}\n`;
  const blob = new Blob([md], {type:'text/markdown'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='pagepulse-seo-report.md'; a.click(); URL.revokeObjectURL(a.href);
});

try{ 
  const saved = JSON.parse(localStorage.getItem('pagePulseSEODraft')||'null'); 
  if(saved){ 
    setState(saved); 
  }
  analyze();
}catch(e){}
</script>
</body>
</html>
